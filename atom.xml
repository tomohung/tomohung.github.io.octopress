<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[The Life Alchemist]]></title>
  <link href="http://www.tomohung.com/atom.xml" rel="self"/>
  <link href="http://www.tomohung.com/"/>
  <updated>2015-04-09T16:49:33+08:00</updated>
  <id>http://www.tomohung.com/</id>
  <author>
    <name><![CDATA[Tomo]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Reflection to Tealeaf Course3 Week5 (2/2)]]></title>
    <link href="http://www.tomohung.com/blog/2015/04/09/reflection-to-tealeaf-course3-week5-2-slash-2/"/>
    <updated>2015-04-09T15:58:27+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/04/09/reflection-to-tealeaf-course3-week5-2-slash-2</id>
    <content type="html"><![CDATA[<h3>Continuous Integration(CI) and Continous Delivery(CD)</h3>

<p>This part is super exciting so I decide to make it a individual post.</p>

<p>Continuous Integration(CI) and Continous Delivery(CD) are two of most important part in automation development. There are plenty of innovation tools, but I think the work flow is the key to understand.</p>

<ol>
<li>Pull the latest code from GitHub.</li>
<li>Create a new feature branch and develop.</li>
<li>Finish development and put to a feature named branch on GitHub.</li>
<li>Create a PR from this branch to <code>staging</code> branch.</li>
<li>Wait CI test for staging branch.</li>
<li>CI automatically deploy from staging branch to <code>staging server</code>.</li>
<li>Manual test on staging server.</li>
<li>Create PR from staging to <code>master</code> branch.</li>
<li>trigger CI for master branch and automatically deploy to <code>production server</code>.</li>
</ol>


<h3>Setting CI and CD</h3>

<p>Here we use <a href="https://circleci.com">Circle CI</a> for CI and CD. There is also well known service called <a href="https://travis-ci.org/">Travis CI</a>.</p>

<ul>
<li>Create a <code>staging</code> branch.</li>
<li>Follow Circle CI project setting.</li>
<li>You may need Heroku API key and SSH.</li>
<li>[Key] Create a <code>circle.yml</code> in the root of project, adjust <code>production_app_name</code> and <code>staging_app_name</code>.</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>machine:
</span><span class='line'>  ruby:
</span><span class='line'>    version: 2.1.5
</span><span class='line'>deployment:
</span><span class='line'>  production:
</span><span class='line'>    branch: master
</span><span class='line'>    commands:
</span><span class='line'>      - heroku maintenance:on --app production_app_name
</span><span class='line'>      - heroku pg:backups capture --app production_app_name
</span><span class='line'>      - git push git@heroku.com:production_app_name.git $CIRCLE_SHA1:refs/heads/master
</span><span class='line'>      - heroku run rake db:migrate --app production_app_name
</span><span class='line'>      - heroku maintenance:off --app production_app_name
</span><span class='line'>  staging:
</span><span class='line'>    branch: staging
</span><span class='line'>    commands:
</span><span class='line'>      - heroku maintenance:on --app staging_app_name
</span><span class='line'>      - git push git@heroku.com:staging_app_name.git $CIRCLE_SHA1:refs/heads/master
</span><span class='line'>      - heroku run rake db:migrate --app staging_app_name
</span><span class='line'>      - heroku maintenance:off --app staging_app_name</span></code></pre></td></tr></table></div></figure>


<p>I got an error when running Circle test: [counldn&rsquo;t find file &lsquo;bootstrap&rsquo;]</p>

<p>Solution: Rename file <code>stylesheets/application.css</code> to <code>stylesheets/application.css.scss</code>. And add Line to the file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@import 'bootstrap-sprockents'
</span><span class='line'>@import 'bootstrap'</span></code></pre></td></tr></table></div></figure>


<p>and remove line <code>*= require bootstrap</code>.</p>

<h3>Embeded Badget</h3>

<p>I aslo try to use badget in my homepage.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>%img(src="https://circleci.com/gh/tomohung/myflix.png?circle-token=a7c782deb0d0022335fa1f095e268bb44eb4cab8")</span></code></pre></td></tr></table></div></figure>


<p>Then I can see this passing test badget.</p>

<p><img src="https://circleci.com/gh/tomohung/myflix.png?circle-token=a7c782deb0d0022335fa1f095e268bb44eb4cab8"></p>

<h3>Slack ingegration with Github and Circle CI</h3>

<p>I failed to use <a href="http://ccmenu.org/">CCMenu</a> to have a notification. But I use <a href="https://slack.com/">Slack</a> to integrate GitHub and Circle CI, and that&rsquo;s why I said it&rsquo;s exciting!!</p>

<p>After setting done, the only thing I need to do is <code>git push origin staging</code> or <code>git push origin master</code>. I&rsquo;ll get notifications in Slack when Github got a push event, and Circle CI run the test and deployment in the same time. Surely I will also get a Circle CI result notification if test and deployment finished.</p>

<p>This is what a programmer should do!! Don&rsquo;t Repeat Yourself!! Bravo!!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reflection to Tealeaf Course3 Week5 (1/2)]]></title>
    <link href="http://www.tomohung.com/blog/2015/04/09/reflection-to-tealeaf-course3-week5/"/>
    <updated>2015-04-09T14:39:06+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/04/09/reflection-to-tealeaf-course3-week5</id>
    <content type="html"><![CDATA[<h3>Feature test for sending email</h3>

<p>Following by <a href="http://www.tomohung.com/blog/2015/04/07/reflection-to-tealeaf-course3-week4/">previous week</a>, this week we have a feature test for sending email.</p>

<p>Install gem,</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ gem 'capybara-email'</span></code></pre></td></tr></table></div></figure>


<p>And added this line to <code>spec_helper.rb</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>require 'capybara/email/rspec'</span></code></pre></td></tr></table></div></figure>


<p>Then</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>require 'spec_helper'
</span><span class='line'>
</span><span class='line'>feature 'User resets password' do
</span><span class='line'>  scenario 'user successfully resets the password' do
</span><span class='line'>    clear_emails
</span><span class='line'>
</span><span class='line'>    user = Fabricate(:user)
</span><span class='line'>    visit sign_in_path
</span><span class='line'>    click_link 'Forgot Password?'
</span><span class='line'>
</span><span class='line'>    fill_in 'Email Address', with: user.email
</span><span class='line'>    click_button 'Send Email'
</span><span class='line'>
</span><span class='line'>    open_email(user.email)
</span><span class='line'>    current_email.click_link("Reset Password")
</span><span class='line'>
</span><span class='line'>    fill_in 'New Password', with: 'new_password'
</span><span class='line'>    click_button 'Reset Password'
</span><span class='line'>
</span><span class='line'>    fill_in 'Email Address', with: user.email
</span><span class='line'>    fill_in 'Password', with: 'new_password'
</span><span class='line'>    click_button 'Sign in'
</span><span class='line'>    expect(page).to have_content("Welcome, #{user.full_name}")
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Especially notice for <code>open_email</code>, <code>current_email</code> functions are offered by <code>capybara-email</code> gem.</p>

<h3>Invite Friend and Registeration</h3>

<p>We also have a work on inviting friends through email, the key point here is how to use a secure <code>token</code> to tracking data.</p>

<ul>
<li>create an invitations data, including inviter, recipient email, name, and <code>token</code>.</li>
<li><p>when user get the email, following the link provided to server, page will direct to the register page with existing data stored with this token.</p>

<p>And set the routes for path</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>get 'register/:token', to: 'users#new_with_invitation_token'</span></code></pre></td></tr></table></div></figure>


<ul>
<li>we can have a hidden data in the register form for new#users to use.</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>= hidden_field_tag :token, @invitation_token</span></code></pre></td></tr></table></div></figure>


<p>we don&rsquo;t use form_for element, becuase this hidden attribute does not belong to backend modeled form.</p>

<h3>Concerns</h3>

<p>To Dry our code, we can use <code>concern</code> with <code>module</code>. Here is a <a href="https://signalvnoise.com/posts/3372-put-chubby-models-on-a-diet-with-concerns">post by DHH</a> why we should do this.</p>

<p>We can merge the same function feature into concern file. For example: <code>Tokenable</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#/lib/tokenable.rb
</span><span class='line'>module Tokenable
</span><span class='line'>  extend ActiveSupport::Concern
</span><span class='line'>  included do
</span><span class='line'>    before_create :generate_token
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  private
</span><span class='line'>  def generate_token
</span><span class='line'>    self.token = SecureRandom.urlsafe_base64
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Then add to model file</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>require 'tokenable'
</span><span class='line'>
</span><span class='line'>class User &lt; ActiveRecord::Base
</span><span class='line'>  include Tokenable
</span><span class='line'>  ...
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>I prefer to specify require file name, or we can use <a href="http://stackoverflow.com/questions/19098663/auto-loading-lib-files-in-rails-4">auto loading library files</a>.</p>

<h3>Email Service Providers</h3>

<p>Since we have test email sending on ENV:development and EVN:test, now we have test it in the real world. That&rsquo;s why we need a real email service provider. Google has it but with many restriction, Tealeaf recommend <code>Mailgun</code> or <code>Postmark</code>. Here we have a taste for `Mailgun&#8217;.</p>

<p>To setting <code>config/environments/production.rb</code>, add these lines:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>config.action_mailer.default_url_options = { :host =&gt; "tomo-myflix.herokuapp.com" }
</span><span class='line'>  config.action_mailer.smtp_settings = {
</span><span class='line'>    :port           =&gt; ENV['MAILGUN_SMTP_PORT'],
</span><span class='line'>    :address        =&gt; ENV['MAILGUN_SMTP_SERVER'],
</span><span class='line'>    :user_name      =&gt; ENV['MAILGUN_SMTP_LOGIN'],
</span><span class='line'>    :password       =&gt; ENV['MAILGUN_SMTP_PASSWORD'],
</span><span class='line'>    :domain         =&gt; 'tomo-myflix.herokuapp.com',
</span><span class='line'>    :authentication =&gt; :plain,
</span><span class='line'>  }
</span><span class='line'>  config.action_mailer.delivery_method = :smtp</span></code></pre></td></tr></table></div></figure>


<p><code>tomo-myflix.herokuapp.com</code> is my app name on Heroku. And ENV about Mailgun are maintained by Heroku.</p>

<p>I aslo can use this command to check <code>Heroku configurations</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ heroku config</span></code></pre></td></tr></table></div></figure>


<p>Then push it to heroku and test for a real email address, it works!!</p>

<h3>Background Jobs</h3>

<p>Sometimes, some actions do not need to be synchrous, like sending email, we don&rsquo;t need to wait email sending action completed. That&rsquo;s why we need to use a background job to do sending email to speed up the flow.</p>

<p><code>Sidekiq</code> and <code>Resque</code> are some of this concept product. And Tealeaf recommend to use <a href="https://github.com/mperham/sidekiq/wiki">Sidekiq</a>.</p>

<p>Install gem Sidekiq</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem 'sidekiq'</span></code></pre></td></tr></table></div></figure>


<p>Only a tiny change for using it by delay method</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>AppMailer.delay.notify_on_new_todo(current_user, @todo) # new 
</span><span class='line'>AppMailer.notify_on_new_todo(current_user, @todo).deliver #older one
</span></code></pre></td></tr></table></div></figure>


<p>Add this line in <code>spec/spec_helper.rb</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>require 'sidekiq/testing/inline'</span></code></pre></td></tr></table></div></figure>


<p>Here we setup sidekiq, but we still need start <code>Redis</code> server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ brew install redis
</span><span class='line'>$ redis-server /usr/local/etc/redis.conf</span></code></pre></td></tr></table></div></figure>


<p>And this start sidekiq with another terminal:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ bundle exec sidekiq</span></code></pre></td></tr></table></div></figure>


<p>So far, this makes <code>local</code> works fine with <code>sidekiq</code> for background jobs. If we want to use background jobs in ENV:production, Heroku take charges if dyno is more than 1, or try <a href="https://coderwall.com/p/fprnhg/free-background-jobs-on-heroku">this way to simulate</a></p>

<p>I have not implemented this yet, but I&rsquo;ll try it later.</p>

<p>There is also <a href="https://devcenter.heroku.com/articles/procfile#deploying-to-heroku">an article talking about Procfile and Foreman</a>.</p>

<p>If sidekiq version >= 3.0, you might also run this line</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>heroku config:set REDIS_PROVIDER=REDISTOGO_URL</span></code></pre></td></tr></table></div></figure>


<h3>Monitor Production Error</h3>

<p>Here we have a try for <a href="https://getsentry.com/welcome/">Sentry</a>.</p>

<p>Tracking errors is also a key for automation deployment.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reflection to Tealeaf Course3 Week4]]></title>
    <link href="http://www.tomohung.com/blog/2015/04/07/reflection-to-tealeaf-course3-week4/"/>
    <updated>2015-04-07T13:11:30+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/04/07/reflection-to-tealeaf-course3-week4</id>
    <content type="html"><![CDATA[<h3>Three kinds of BDD</h3>

<p>In week 4 beginning, we got a brief intro for 3 kinds of BDD:</p>

<ul>
<li><p>meet in the middle</p>

<p>I think this should be the popular one for modern development. The front-end engineer build the pages from mockups, then back-end developer connect UI with controllers and models.</p></li>
<li><p>inside out</p>

<p>It develops from models to controllers till views and integrations. It&rsquo;s hard to decide what models you really need in the beginning.</p></li>
<li><p>outside in</p>

<p>It devlops from integrations to controllers and models. It start from a big vision, and close to what user&rsquo;s need. But for developer, it&rsquo;s hard to code from this big vision, especially for integration test in the development beginning.</p></li>
</ul>


<h3>Self Referential Associations</h3>

<p>We can use <strong>self referential association</strong> to let user track other users. For example:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># t.integer :follower_id, :leader_id
</span><span class='line'>class Relationship &lt; ActiveRecord::Base
</span><span class='line'>  belongs_to :follower, class_name: 'User'
</span><span class='line'>  belongs_to :leader, class_name: 'User'
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Then, model <code>User</code> can have these virtual attributes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  has_many :following_relationships, class_name: 'Relationship', foreign_key: :follower_id
</span><span class='line'>  has_many :leading_relationships, class_name: 'Relationship', foreign_key: :leader_id</span></code></pre></td></tr></table></div></figure>


<h3>Sending Emails</h3>

<p>Rails also offer <code>ActionMailer</code> for sending emails.</p>

<ul>
<li>create files in <code>app/mailers/app_mailer.rb</code></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class AppMailer &lt; ActionMailer::Base
</span><span class='line'>
</span><span class='line'>  def send_welcome_email(user)
</span><span class='line'>    @user = user
</span><span class='line'>    mail to: user.email, from: 'info@myflix.com', subject: 'Welcome to Myflix'
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>View</code> template in <code>app/views/app_mailers/send_welcome_email</code>:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>%html(lang='en-US')
</span><span class='line'>  %body
</span><span class='line'>    %p Welcome to MyFlix, #{@user.full_name}</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Config for <code>config/environments/development.rb</code></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>config.action_mailer.delivery_method = :letter_opener</span></code></pre></td></tr></table></div></figure>


<p>And</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>group :development do
</span><span class='line'>  gem 'letter-opener'
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<blockquote><p>This is only for <code>development</code> setting, we also need to set for <code>test</code> and <code>production</code> independent</p></blockquote>

<h3>Handling Sensitive Account Info</h3>

<p>It&rsquo;s dangerous to upload config setting file to github or other public storage, there is someone update AWS key to GitHub and got a unbelievable credit bill.</p>

<p>Use <code>ENV</code> to protect secret data, we can use gem <code>Figaro</code>.
<a href="https://github.com/laserlemon/figaro">Figara</a> is the simplest way to keep our key value safe.</p>

<p>There are two posts talking about this topic:</p>

<ol>
<li><a href="http://railsapps.github.io/rails-environment-variables.html">Rails Environment Variables</a></li>
<li><a href="https://devcenter.heroku.com/articles/config-vars">Configuration and config Vars</a></li>
</ol>


<blockquote><p>Update: Tealeaf also have a post about <a href="http://www.gotealeaf.com/blog/managing-environment-configuration-variables-in-rails">Managing Environment Configuration Variables in Rails</a></p></blockquote>

<h3>Test Email sending</h3>

<p>Remember to clear email deliveries before test:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>before { ActionMailer::Base.deliveries.clear }
</span></code></pre></td></tr></table></div></figure>


<p>Then we can validate email in the test by this</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>post :create
</span><span class='line'>expect(ActionMailer::Base.deliveries.last.to).to eq([user_attributes["email"]])
</span><span class='line'># expect(ActionMailer::Base.deliveries.last.body).to include(user_attributes["full_name"])</span></code></pre></td></tr></table></div></figure>


<h3>Update database, use rake tasks</h3>

<p>An advice from TA Tomtomecek, I update existing data in model User, and he suggest me to use <a href="http://guides.rubyonrails.org/command_line.html#custom-rake-tasks">custom rake tasks</a> to do that. I&rsquo;ve not taste that yet, just leave a memo here to remember.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reflection to Tealeaf Course3 Week3]]></title>
    <link href="http://www.tomohung.com/blog/2015/03/17/reflection-to-tealeaf-course3-week3/"/>
    <updated>2015-03-17T09:41:26+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/03/17/reflection-to-tealeaf-course3-week3</id>
    <content type="html"><![CDATA[<p><a href="http://www.tomohung.com/blog/2015/03/11/reflection-to-tealeaf-course3-week2/">In week 2</a>, Tealeaf talked about how to test controller, and this week, I got a more comprehensive test consideration for controller and user interaction.</p>

<h3>For Controller Test</h3>

<ul>
<li>Everytime add a function feature, also need to add a test for it.</li>
<li>Everytime find a bug, also add a test for it.</li>
</ul>


<h3>DRY</h3>

<p>RSpec also offer two ways to DRY code.</p>

<h4>- Macro</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir spec/support
</span><span class='line'>$ touch macros.rb</span></code></pre></td></tr></table></div></figure>


<p>And we can move repeatedly code into here, for example, we usually need to set a login user:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def set_current_user(user = nil)
</span><span class='line'>  session[:user_id] = (user || Fabricate(:user)).id
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>and find user</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def current_user
</span><span class='line'>  User.find(session[:user_id])
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<h4>- Shared Examples</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ touch spec/support/share_examples.rb</span></code></pre></td></tr></table></div></figure>


<p>A test method may be called through different controllers:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>shared_examples 'requre_sign_in' do
</span><span class='line'>  it 'redirects to the root page'
</span><span class='line'>    action
</span><span class='line'>    expect(response).to redirect_to root_path
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Be careful: <code>action</code> is a <strong>variable</strong>, then when using it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>it_behaves_like 'require_sign_in' do
</span><span class='line'>  let(:action) { get :index }
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<h3>Feature Specs</h3>

<p>There are two methods to test user interactions, one is <code>request spec</code> and this is deprecated by <strong>Capybara</strong>. The other one is <code>feature specs</code>, recommended by <strong>Capybara</strong>.</p>

<p><strong>Capybara</strong> offer functions that we can click link/button, fill text field&hellip;etc, to interactive with UI.</p>

<h4>- Install Capybara gem</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>group :test
</span><span class='line'>  gem 'capybara'
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Also add this line to test helper file</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>requrire 'capybara/rails'</span></code></pre></td></tr></table></div></figure>


<p>And</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$mkdir spec/features
</span><span class='line'>$touch user_signs_in_spec.rb</span></code></pre></td></tr></table></div></figure>


<h4>- A sample for user operation:</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>feature 'user interacts with the queue' do 
</span><span class='line'>
</span><span class='line'>  scenario 'user adds and reorder videos in the queue' do
</span><span class='line'>    category    = Fabricate(:category)
</span><span class='line'>    monk        = Fabricate(:video, title: 'monk', category: category)
</span><span class='line'>    futurama    = Fabricate(:video, title: 'futurama', category: category)
</span><span class='line'>    south_park  = Fabricate(:video, title: 'south park', category: category)
</span><span class='line'>
</span><span class='line'>    sign_in
</span><span class='line'>    expect(page).to have_content 'You have signed in.'
</span><span class='line'>
</span><span class='line'>    add_video_to_queue(monk)
</span><span class='line'>    expect(page).to have_content(monk.title)
</span><span class='line'>
</span><span class='line'>    visit video_path(monk)
</span><span class='line'>    expect(page).not_to have_content('+ My Queue')
</span><span class='line'>
</span><span class='line'>    add_video_to_queue(futurama)
</span><span class='line'>    add_video_to_queue(south_park)
</span><span class='line'>
</span><span class='line'>    set_video_order(monk, 3)
</span><span class='line'>    set_video_order(futurama, 1)
</span><span class='line'>    set_video_order(south_park, 2)
</span><span class='line'>
</span><span class='line'>    expect_video_order(monk, 3)
</span><span class='line'>    expect_video_order(futurama, 1)
</span><span class='line'>    expect_video_order(south_park, 2)
</span><span class='line'>  end
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>def add_video_to_queue(video)
</span><span class='line'>  visit home_path
</span><span class='line'>  find("a[href='/videos/#{video.id}']").click
</span><span class='line'>  expect(page).to have_content(video.title)
</span><span class='line'>  click_link '+ My Queue'
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>def set_video_order(video, order)
</span><span class='line'>  within(:xpath, "//tr[contains(.,'#{video.title}')]") do
</span><span class='line'>    fill_in 'queue_items[][position]', with: order
</span><span class='line'>  end
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>def expect_video_order(video, order)
</span><span class='line'>  expect(find(:xpath, "//tr[contains(.,'#{video.title}')]//input[@type='text']").value).to eq(order.to_s)
</span><span class='line'>end
</span></code></pre></td></tr></table></div></figure>


<p>here I choose to use <code>:xpath</code>.</p>

<h4>- One level for scenario</h4>

<p>In above sample, I extract methods <code>add_video_to_queue</code>, <code>set_video_order</code>, and <code>expect_video_order</code>. This is we want to keep a principle <code>Abstract one level for scenario</code>. Encapsulating logic code and keep main code readable on the same abstract level can help reader to review.</p>

<h3>Rails Conventions</h3>

<h4>- Merge Params</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>= form_tag update_queue_path do
</span><span class='line'>  ...
</span><span class='line'>  %td= text_field_tag 'queue_items[][position]', queue_item.position
</span><span class='line'>  =hidden_field_tag 'queue_items[][id]', queue_item.id
</span><span class='line'>
</span><span class='line'>  =submit_tag 'Update'</span></code></pre></td></tr></table></div></figure>


<p>Then we will get a hash value <code>params[queue_items] = {position: xxx, id: xxx}</code></p>

<h4>- select_tag</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>%td= select_tag 'queue_items[][rating]', options_for_video_reviews(queue_item.rating), include_blank: true</span></code></pre></td></tr></table></div></figure>


<p>And <code>options_for_video_reviews</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def options_for_video_reviews(selected = nil)
</span><span class='line'>  options_for_select((1..5).map { |num| [pluralize(num, 'Star'), num]}, selected)
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Be careful that <code>[pluralize(num, 'Star'), num]</code> is a pair value.</p>

<h4>- ActiveRecord Transactions</h4>

<p>A sample from Rails Tutorial</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ActiveRecord::Base.transaction do
</span><span class='line'>  david.withdrawal(100)
</span><span class='line'>  mary.deposit(100)
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>If any one of <code>david.withdrawl</code> or <code>mary.deposit</code> raise an exception(<strong>Be careful: there must be a raising error to trigger transaction</strong>), all database record in this action will be rollback. It deal with batch action with database. So I have to care about what functions will raise an exception when fail. Ex. <code>update</code> return a fail, and <code>update!</code> raise an exception.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reflection to Tealeaf Course3 Week2]]></title>
    <link href="http://www.tomohung.com/blog/2015/03/11/reflection-to-tealeaf-course3-week2/"/>
    <updated>2015-03-11T11:21:17+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/03/11/reflection-to-tealeaf-course3-week2</id>
    <content type="html"><![CDATA[<p>There are 3 kinds of test: <code>Unit</code>, <code>Functional</code>, <code>Integration</code>. In <a href="http://www.tomohung.com/blog/2015/03/06/reflection-to-tealeaf-course3-week1/">week 1</a>, we test <strong>Model</strong>, this should belong to <code>Unit test</code> . And this week we test <strong>Controller</strong>, this should belong to <code>Functional test</code>. I guess it should be <code>Integration test</code> when we move into part of <strong>View</strong> test.</p>

<p>I have to heavily rely on solution videos, there are two main reasons:</p>

<ol>
<li><p>I&rsquo;m not familiar with <code>what to test</code>, because I&rsquo;m a starter for TDD. It&rsquo;s a big conversion <strong>from test laster to test driven</strong>.</p></li>
<li><p>I&rsquo;m not familiar with <code>RSpec</code>. There are some tricks for test controllers when using RSpec.</p></li>
</ol>


<p>For example, when we test `QueueItemsController#create&#8217;, there are 7 tests:</p>

<ul>
<li>it &lsquo;redirects to my queue page&rsquo;</li>
<li>it &lsquo;creates a queue item&rsquo;</li>
<li>it &lsquo;creates the queue item associated with video&rsquo;</li>
<li>it &lsquo;creates the queue item associated with current user&rsquo;</li>
<li>it &lsquo;puts the video as the last one in the queue&rsquo;</li>
<li>it &lsquo;does not add the video in the queue if already existed in the queue&rsquo;</li>
<li>it &lsquo;redirects to sign in page if unauthenticated&rsquo;</li>
</ul>


<p>A simple action needs to do such lots of tests!!</p>

<p>Or here is for <strong>Model</strong> methods: <code>search_by_title</code>:</p>

<ul>
<li>it &lsquo;returns empty array if no match&rsquo;</li>
<li>it &lsquo;returns an array if one video&rsquo;</li>
<li>it &lsquo;returns an array if partial match&rsquo;</li>
<li>it &lsquo;returns an array of all matches ordered by DESC&rsquo;</li>
<li>it &lsquo;returns an empty array for search an empty string&rsquo;</li>
</ul>


<p>To test every possible situations is not an easy work.</p>

<p>Brandon also metioned me that care about using <code>let</code> and <code>before</code>. Because of lots of tests in spec files, we may miss some pre-declare vars by using <code>let</code> or <code>before</code>. Sometimes, it may be better do not clean duplicated codes for code readability.</p>

<p>Second, extract methods into <strong>Model</strong>. ex:</p>

<figure class='code'><figcaption><span>user.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">queue_include?</span><span class="p">(</span><span class="n">video</span><span class="p">)</span>
</span><span class='line'>    <span class="n">queue_items</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:video</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">video</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>then, I can use this method everywhere in my app.</p>

<h3>Conclusion</h3>

<p>Still on the way to be more familiar to do TDD. :-)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reflection to Tealeaf Course3 Week1]]></title>
    <link href="http://www.tomohung.com/blog/2015/03/06/reflection-to-tealeaf-course3-week1/"/>
    <updated>2015-03-06T08:40:32+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/03/06/reflection-to-tealeaf-course3-week1</id>
    <content type="html"><![CDATA[<p>In Course3 week1, Kevin give me a schema of what should developper do from beginning.</p>

<p>There are so many subjects I&rsquo;ve heard but not ever practicing in action, like: TDD, git flow(github flow), why test&hellip;etc.</p>

<p>I like the concept Red-Green-Refactor, it forced developper thinking about what you should do first. This may be argued by some experienced engineer, because they can do these works naturally.</p>

<p>But followed by Red-Green-Refactor, seeing green light really makes me feel comfortable. I can&rsquo;t stop thinking about how it&rsquo;d become easier if I could use this method when developping AI for TicTacToe. Testing game logic in TicTacToe manually costs me lots of time.</p>

<p>Git flow/ GitHub flow is also my first time to taste. I think this should be fun to start communicate with other programmers through pull request. Glad that Tealeaf built an environment to let us feel like we are really in work.</p>

<p>Matthew also metioned about this I should care about: <a href="http://stackoverflow.com/questions/729692/why-should-files-end-with-a-newline">Why should files end with a newline</a>.
<br/></p>

<p>I also find a blog post talking about <a href="http://www.jamesshore.com/Blog/Red-Green-Refactor.html">Red-Green-Refactor</a>, the author split the process into 5 steps: <strong>Think, Red, Green, Refactor, Repeat</strong>, and called this <code>code design process</code>. :-)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Titan's Tic Tac Toe]]></title>
    <link href="http://www.tomohung.com/blog/2015/03/03/titans-tic-tac-toe/"/>
    <updated>2015-03-03T09:11:10+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/03/03/titans-tic-tac-toe</id>
    <content type="html"><![CDATA[<p><img src="http://i.minus.com/i2XJ0y9E48CHg.png"></p>

<h3>Prelude</h3>

<p>This is a blog entry for record my first personal project for Rails, and focus on what&rsquo;s are first time if starting a new project <code>From Zero To One</code>.</p>

<p><code>Titan's Tic Tac Toe</code> is my first personal app for Rails.</p>

<p>Website: <a href="https://young-castle-5534.herokuapp.com/">https://young-castle-5534.herokuapp.com/</a></p>

<p>GitHub repo: <a href="https://github.com/tomohung/tictactoe-rails">https://github.com/tomohung/tictactoe-rails</a></p>

<p>This project is activated by Tealeaf Course 2(Rapid Prototyping with Ruby on Rails), we are asked to do a personal project by ourself. In course 1(Introduction to Ruby and Web Development), we have an optional assignment to build a game <code>Tic Tac Toe</code> engine by Object-Oriented, that is, to give this game AI. I spent a lot of time to design logic, and I believe I have a good job for this. This is why I choose this subject for my personal project. And reuse my code is also a kind of <code>DRY</code> way.</p>

<!--more-->


<p><strong>Warning</strong></p>

<p>I have to admit that I make a big mistake, because I am using a class variable to control <strong>Game Board</strong> status. This work when only me to play with it, but after deployment it will become disaster when multiple player play together. Player share the same game status and sometimes it look weird.</p>

<p>I should use sessions or database to store game status, and extract methods from class GameBoard to controller. I won&rsquo;t fix this problem but writing this blog entry to record this.</p>

<p><strong>Do no use <code>class vars</code> and <code>global vars</code> in Rails.</strong></p>

<h3>Concepts</h3>

<p>Before implementation, I need to split works into pieces.</p>

<ol>
<li>Game enegine.</li>
<li>Game board implementation.</li>
<li>Ladder for record user&rsquo;s game result.</li>
<li>User&rsquo;s register system and Login/out.</li>
</ol>


<h3>Update Environment</h3>

<p>RVM and rbenv are two popular Ruby version manager. I choose RVM, but rbenv is also a good choice.
It makes me easy to switch different versions Ruby between different projects.
I use <code>Ruby version 2.2.0</code>, and <code>Rails 4.2.0</code> for this new project.</p>

<p>Then create a new Rails project</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rails new project_name</span></code></pre></td></tr></table></div></figure>


<p>Specify version in GemFile</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem 'rails', '4.2.0'
</span><span class='line'>ruby "2.2.0"
</span><span class='line'>
</span><span class='line'>gem 'bootstrap-sass', '~&gt; 3.3.3'</span></code></pre></td></tr></table></div></figure>


<h3>Game Engine</h3>

<p>The game engine is already done in Course 1, so I just modified some codes to fit web process.
GitHub repo: <a href="https://github.com/tomohung/tictactoe-rails/blob/master/lib/oo_tic_tac_toe.rb">https://github.com/tomohung/tictactoe-rails/blob/master/lib/oo_tic_tac_toe.rb</a></p>

<h3>Game Board</h3>

<p>  I&rsquo;m a newbie for HTML &amp; CSS, so Bootstrap will be my best choice. It offer lots of template with high quality, and mobile first.</p>

<p>  I choose <a href="http://getbootstrap.com/examples/cover/">template-cover</a> for my project, it looks clean and suit for my application.</p>

<h4>Bootstrap</h4>

<ol>
<li> Download Bootstrap, unzip it, then find source code in <code>/docs/examples/cover</code>.</li>
<li> I got two files, <code>index.html</code> and <code>cover.css</code>.</li>
<li> combine <code>index.html</code> into Rails <code>views/layout/application.html.erb</code>.</li>
</ol>


<p>  It may looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;title&gt;</span>Tic Tac Toe<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>  <span class="err">&lt;</span>%= stylesheet_link_tag    &#39;application&#39;, media: &#39;all&#39;, &#39;data-turbolinks-track&#39; =&gt; true %&gt;
</span><span class='line'>  <span class="err">&lt;</span>%= javascript_include_tag &#39;application&#39;, &#39;data-turbolinks-track&#39; =&gt; true %&gt;
</span><span class='line'>  <span class="err">&lt;</span>%= csrf_meta_tags %&gt;
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;site-wrapper&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;site-wrapper-inner&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;cover-container&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="err">&lt;</span>%= render &#39;layouts/navigator&#39; %&gt;
</span><span class='line'>        <span class="err">&lt;</span>%= render &#39;layouts/messages&#39; %&gt;
</span><span class='line'>        <span class="err">&lt;</span>%= yield %&gt;
</span><span class='line'>        <span class="err">&lt;</span>%= render &#39;layouts/footer&#39; %&gt;
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>  I use partial <code>layouts/navigator</code> and <code>layouts/footer</code> to clean the code.</p>

<h4>CSS for cover.css</h4>

<p>  The page looks not good, because CSS is not included. Copy <code>cover.css</code> to <code>/assets/stylesheets</code>. Rails will automatically include CSS files in this directory.</p>

<p>  So far is good, but something wrong when I want to use other bootstrap components.
  After google that, this is because I haven&rsquo;t import bootstrap!! I&rsquo;m using just cover.css for this template.</p>

<p>  Changing file name <code>assets/applications.css</code> to <code>asstes/application.scss</code>, and add this code</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  @import &quot;bootstrap-sprockets&quot;;
</span><span class='line'>  @import &quot;bootstrap&quot;;
</span></code></pre></td></tr></table></div></figure>


<p>  <code>bootstrap-sprockets</code> has to be imported otherwise <strong>icon</strong> can&rsquo;t be displayed.</p>

<p>  Well, bootstrap components works, but ruin all my template.</p>

<p>  After trial and error, I merge <code>cover.css</code> code into <code>application.scss</code>, and put behind <code>@import "bootstrap"</code>. Rails may load other css files in <code>assets</code> directory, then application.scss import bootstrap, overwrite those class attributes.</p>

<p>  After these setting, now my cover template works well with Bootstrap. I aslo test on my iPhone, it shows pretty good, Bootstrap is awesome!!</p>

<h4>CSS for GameBoard</h4>

<p>  The hardest part for me is to build a game board. I search from web and get some solution, but there&rsquo;s no better solution to draw a symbol <code>X</code>, I decide to display it by another style circle. One more thing, I add the feature when mouse <code>hover</code> on choosen square, it will render a temparary fake circle. This makes game much friendly. Here is the css file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nc">.doughnut</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
</span><span class='line'>  <span class="k">border</span><span class="o">:</span> <span class="m">10px</span> <span class="k">solid</span> <span class="m">#f00</span><span class="p">;</span>
</span><span class='line'>  <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">50px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">height</span><span class="o">:</span><span class="m">60px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span><span class="m">60px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.host_doughnut</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
</span><span class='line'>  <span class="k">border</span><span class="o">:</span> <span class="m">5px</span> <span class="k">solid</span> <span class="m">#fff</span><span class="p">;</span>
</span><span class='line'>  <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">20px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">height</span><span class="o">:</span><span class="m">60px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span><span class="m">60px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.unpicked</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
</span><span class='line'>  <span class="k">height</span><span class="o">:</span><span class="m">60px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span><span class="m">60px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">border</span><span class="o">:</span> <span class="m">2px</span> <span class="k">dashed</span> <span class="m">#444</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.unpicked</span><span class="nd">:hover</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">border</span><span class="o">:</span> <span class="m">10px</span> <span class="k">solid</span> <span class="m">#f66</span><span class="p">;</span>
</span><span class='line'>  <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">50px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">height</span><span class="o">:</span><span class="m">60px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span><span class="m">60px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Ajax</h4>

<p>  Everytime player choose the square, the whole page will reload again. This is not good for a modern web app. Using Ajax to improve it.</p>

<p>  The keyword is add a ID for picked squre.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'>  <span class="o">&lt;</span><span class="nt">div</span> <span class="nt">id</span> <span class="o">=</span> <span class="s1">&#39;pick_&lt;%= number %&gt;&#39;</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>  in <code>GameController</code>, we use <code>respond_to</code> to trigger js:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>    <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">redirect_to</span> <span class="n">game_path</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="nb">format</span><span class="o">.</span><span class="n">js</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">host_pick</span>
</span><span class='line'>      <span class="n">winner</span> <span class="o">=</span> <span class="vi">@board</span><span class="o">.</span><span class="n">game_is_over?</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">winner</span>
</span><span class='line'>        <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;OH NO!! You are DEAD!&#39;</span> <span class="k">if</span> <span class="n">winner</span> <span class="o">==</span> <span class="vi">@host</span>
</span><span class='line'>        <span class="n">render</span> <span class="ss">:js</span> <span class="o">=&gt;</span> <span class="s2">&quot;window.location = &#39;/game/over&#39;&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>Note: I use <code>render :js =&gt; "window.location = '/game/over'"</code> to render page /game/over if game is over.</p></blockquote>

<p>  and <code>game.create.js</code> file looks like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="o">&lt;</span><span class="sx">% (1..9).each </span><span class="k">do</span> <span class="o">|</span><span class="n">number</span><span class="o">|</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">    &lt;% if @player_picked_numbers.include? number %&gt;</span>
</span><span class='line'>      <span class="err">$</span><span class="p">(</span><span class="s1">&#39;#pick_&lt;%= number %&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="s2">&quot;&lt;div class=&#39;doughnut&#39;&gt;&lt;/div&gt;&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="sx">% elsif </span><span class="vi">@host_picked_numbers</span><span class="o">.</span><span class="n">include?</span> <span class="n">number</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">      $(&#39;#pick_&lt;%= number %&gt;</span><span class="s1">&#39;).html(&quot;&lt;div class=&#39;</span><span class="n">host_doughnut</span><span class="err">&#39;</span><span class="o">&gt;&lt;</span><span class="sr">/div&gt;&quot;)</span>
</span><span class='line'><span class="sr">    &lt;% end %&gt;</span>
</span><span class='line'><span class="sr">  &lt;% end %&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>  Ajax make this game vivid!!</p>

<h3>User&rsquo;s Register</h3>

<p>Since I need to store game record, I have to add User&rsquo;s Register, this is not a difficult stuff if you had gone through course 2. Here is a simple ERD:</p>

<ul>
<li>User: username, digest_password, timestamps, has_many :game_records</li>
<li>GameRecord: user_id, game_result, attack_times</li>
</ul>


<p>User and GameRecord is a one-to-many assocaition.</p>

<p>Create routes, model, controller, and views follow what we learned in course 2.</p>

<h3>Login/out</h3>

<p>  Create a SessionController to manager user login/logout.
  Use session[:user_id] to store data in cookie.</p>

<ul>
<li>def <code>new</code> to render login page.</li>
<li>def <code>create</code> for login.</li>
<li>def <code>destroy</code> for logout.</li>
</ul>


<blockquote><p>Don&rsquo;t forget to add feature: auto login after user register.</p></blockquote>

<h3>Ladder</h3>

<p>I will show three kinds of game result: Keeper, Winner, Loser.
And I need tab navigation here, still copy from Bootstrap:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">ul</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;nav nav-tabs&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="sx">% params[:tab] </span><span class="o">=</span> <span class="s1">&#39;WIN&#39;</span> <span class="k">if</span> <span class="o">!</span><span class="n">params</span><span class="o">[</span><span class="ss">:tab</span><span class="o">]</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">    &lt;li class=&quot;&lt;%= &#39;active&#39; if params[:tab] == &#39;TIE&#39; %&gt;</span><span class="s2">&quot;&gt;&lt;a href=&quot;</span><span class="c1">#TIE&quot; data-toggle=&quot;tab&quot;&gt;Keepers&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">li</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;&lt;%= &#39;active&#39; if params[:tab] == &#39;WIN&#39; %&gt;&quot;</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;#WIN&quot;</span> <span class="n">data</span><span class="o">-</span><span class="n">toggle</span><span class="o">=</span><span class="s2">&quot;tab&quot;</span><span class="o">&gt;</span><span class="no">Heroes</span><span class="o">&lt;</span><span class="sr">/a&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">li</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;&lt;%= &#39;active&#39; if params[:tab] == &#39;LOSE&#39; %&gt;&quot;</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;#LOSE&quot;</span> <span class="n">data</span><span class="o">-</span><span class="n">toggle</span><span class="o">=</span><span class="s2">&quot;tab&quot;</span><span class="o">&gt;</span><span class="no">Loser</span><span class="o">&lt;</span><span class="sr">/a&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/ul&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;div class=&quot;tab-content&quot;&gt;</span>
</span><span class='line'><span class="sr">  &lt;%= render &#39;column_title&#39; %&gt;  </span>
</span><span class='line'><span class="sr">  &lt;div class=&quot;&lt;%= if (params[:tab] == &#39;TIE&#39; || !params[:tab]) then &#39;tab-pane active&#39;  else &#39;tab-pane&#39; end%&gt;&quot; id=&quot;TIE&quot;&gt;</span>
</span><span class='line'><span class="sr">    &lt;%= render @game_records.where(status: &#39;TIE&#39;) %&gt;</span>
</span><span class='line'><span class="sr">  &lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;&lt;%= if params[:tab] == &#39;WIN&#39; then &#39;tab-pane active&#39;  else &#39;tab-pane&#39; end%&gt;&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;WIN&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="sx">%= render @game_records.where(status: &#39;WIN&#39;) %&gt;</span>
</span><span class='line'><span class="sx">  &lt;/div&gt;</span>
</span><span class='line'><span class="sx">  &lt;div class=</span><span class="s2">&quot;&lt;%= if params[:tab] == &#39;LOSE&#39; then &#39;tab-pane active&#39;  else &#39;tab-pane&#39; end%&gt;&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;LOSE&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;%=</span> <span class="n">render</span> <span class="vi">@game_records</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">status</span><span class="p">:</span> <span class="s1">&#39;LOSE&#39;</span><span class="p">)</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">  &lt;/div&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Tabs do not work? This is because I haven&rsquo;t include javascript for Bootstrap.</p>

<p>Add this line in <code>/assets/javascripts/application.js</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="sr">//</span><span class="o">=</span> <span class="nb">require</span> <span class="n">bootstrap</span><span class="o">-</span><span class="n">sprockets</span>
</span></code></pre></td></tr></table></div></figure>


<p>Well, it works now!!</p>

<p>Then, I found Kevin(Tealeaf Instructor) also write a blog for <a href="http://www.gotealeaf.com/blog/integrating-rails-and-bootstrap-part-1">integrating rails and bootstrap</a>.</p>

<h3>Deploy to Heroku</h3>

<p>Finally, functions all work and ready to deploy to <a href="heroku.com">Heroku</a>. And follow by Heroku instruction, push code, then&hellip;<code>Fail</code>.</p>

<p>Check the log and find something wrong about <code>gem pg</code>. pg is <code>Postgres</code> used by Heroku. Rails default setting is using <code>sqlite3</code>, so I need to do some work in Gemfile:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;pg&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;rails_12factor&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add this code to Gemfile for config :production using Postgres. Run <code>bundle install</code> and git push again, it should work!!</p>

<h3>Conclusion</h3>

<p>In Course 2, we have lots assignments from a prepared template. If I don&rsquo;t start a new project, I will never knew there are lots of minor things I should know. After this project, I have chance to be more familiar with Ruby language, Rails routes, CRUD&hellip;etc.</p>

<h3>Compliment from others</h3>

<p>Record these just for encourage myself to keep going on.</p>

<p>Albert Agram (TA):</p>

<blockquote><p>Hey Tomo, nicely done! I played a few rounds and am impressed. Good job :)
<br/></p></blockquote>

<p>Chris Lee (Tealeaf Instructor):</p>

<blockquote><p>This is incredibly awesome!
<br/>
This type of app doesn&rsquo;t lend itself well to Rails, because it&rsquo;s not
really &ldquo;page oriented&rdquo;. Rails tends to be a better fit for apps like
social networks, or things like that where you have CRUD actions on some
resources.
<br/></p></blockquote>

<p>Brandon Conway (TA):</p>

<blockquote><p>This game is awesome! I really like the ladder implementation.
<br/></p></blockquote>

<p>Eugene Chang:</p>

<blockquote><p>This is a really nice app! After seeing it, I had to constantly resist the temptation of spending more time trying to make my UI look better. Great job!</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reflection to Tealeaf Course2 Lesson4]]></title>
    <link href="http://www.tomohung.com/blog/2015/02/22/reflection-to-tealeaf-course2-lesson4/"/>
    <updated>2015-02-22T21:22:10+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/02/22/reflection-to-tealeaf-course2-lesson4</id>
    <content type="html"><![CDATA[<p>In Course2(Rapid Prototyping with Ruby on Rails), <a href="http://www.tomohung.com/blog/2015/02/02/reflection-to-tealeaf-course-2-lesson-1/">first week</a> I learned about <code>Models and database</code>, <a href="http://www.tomohung.com/blog/2015/02/10/reflection-to-tealeaf-course2-lesson2/">second week</a> I learned about <code>Controllers and Views</code>. The <a href="http://www.tomohung.com/blog/2015/02/16/reflection-to-tealeaf-course2-lesson3/">third week</a> I learned to add <code>Authentication</code> and <code>Polymorphic table</code>.</p>

<p>And this week, also the last week, I completed all basic functions I need to know. Including Ajax for voting, extract methods into gem, build and publish gem, display time info considering user&rsquo;s timezone.</p>

<!--more-->


<h3>Ajax for voting</h3>

<p>Ajax is a clean way to change View template that is necessary changed, and we don&rsquo;t need to redirect and render full page. Rails offer a way to achieve this.</p>

<ul>
<li>in Controller</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>  <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">redirect_to</span> <span class="ss">:back</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="nb">format</span><span class="o">.</span><span class="n">js</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>in View</li>
</ul>


<p><code>format.js</code> will lead to the class#action View file, for example: <code>/votes/create.js.erb</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span><span class="p">(</span><span class="s2">&quot;#voteable_&lt;%= @vote.voteable_type %&gt;_&lt;%= @vote.voteable_id %&gt;&quot;</span><span class="p">)</span><span class="o">.</span>
</span><span class='line'>  <span class="n">html</span><span class="p">(</span><span class="s2">&quot;&lt;%= j render &#39;shared/show_dislike_link&#39;, vote: @vote %&gt;&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>notice that in <code>js.erb</code> file, render should specify format by using <code>j render</code>.</p>

<ul>
<li>HTML ID</li>
</ul>


<p>ID is the key to do Ajax.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">span</span> <span class="nb">id</span> <span class="o">=</span> <span class="s1">&#39;vote_&lt;%=vote.id%&gt;&#39;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sx">%= link_to vote_path(vote), remote: true, method: :delete do %&gt;</span>
</span><span class='line'><span class="sx">    &lt;i class=</span><span class="s1">&#39;icon-thumbs-up&#39;</span><span class="o">&gt;&lt;</span><span class="sr">/i&gt;</span>
</span><span class='line'><span class="sr">    Cancel</span>
</span><span class='line'><span class="sr">  &lt;% end %&gt;</span>
</span><span class='line'><span class="sr">&lt;/s</span><span class="n">pan</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add <code>id</code> for Ajax, and add <code>remote: true</code> for activate Ajax.</p>

<h3>Extract methods</h3>

<p>Using <code>ActiveSupport::Concern</code> to manage module, info from Rails API:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">M</span>
</span><span class='line'>  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">included</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">scope</span> <span class="ss">:disabled</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">disabled</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">class_methods</span> <span class="k">do</span>
</span><span class='line'>    <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>When I using for vote methods:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Voteable</span>
</span><span class='line'>  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>
</span><span class='line'>  <span class="n">included</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">has_many</span> <span class="ss">:votes</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:voteable</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">like_votes</span>
</span><span class='line'>    <span class="nb">self</span><span class="o">.</span><span class="n">votes</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Or Sluggable.rb</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Sluggable</span>
</span><span class='line'>  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">included</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">before_save</span> <span class="ss">:generate_slug</span>
</span><span class='line'>    <span class="n">class_attribute</span> <span class="ss">:slug_column</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">to_param</span>
</span><span class='line'>    <span class="nb">self</span><span class="o">.</span><span class="n">slug</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">generate_slug</span>
</span><span class='line'>    <span class="c1"># ignore...</span>
</span><span class='line'>    <span class="c1"># self.send(self.class.slug_column)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">module</span> <span class="nn">ClassMethods</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">sluggable_column</span><span class="p">(</span><span class="n">noun</span><span class="p">)</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">slug_column</span> <span class="o">=</span> <span class="n">noun</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice that using <code>class_attribute</code> to connect different class symbol. Setting <code>sluggable_column</code> in <code>Models</code>.</p>

<p>Also notice that <code>slug_column</code> is a class methods and return a symbol, in order to get instance&rsquo;s value, use <code>self.send(self.class.slug_column)</code>.</p>

<h3>Slug</h3>

<p>There are two purpose using slug:</p>

<ul>
<li>Don&rsquo;t expose database information.</li>
<li>URL for SEO friendly</li>
</ul>


<p>The concepts to generate slug are:</p>

<ol>
<li>add a slug column to store slug value</li>
<li>substitute key word like <code>name</code> into slug, avoid some keywords for HTTP like <code>@&amp;``'</code> etc.</li>
<li>check slug exsited or not, otherwise add a number for avoiding the same name.</li>
</ol>


<h3>Using Gems</h3>

<p>Gem is a very convenient way to use the same methods between two different projects.</p>

<ol>
<li>build a gem spec file.</li>
<li>copy exsited module codes into gem specify path.</li>
<li>build the gem</li>
<li>publish the gem</li>
<li>add gem to Gemfile, then <code>bundle install</code>.</li>
</ol>


<h3>Time Zone</h3>

<p>Rails offer time zone methods to do this.</p>

<ul>
<li>in model backed form</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">f</span><span class="o">.</span><span class="n">time_zone_select</span> <span class="ss">:time_zone</span><span class="p">,</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TimeZone</span><span class="o">.</span><span class="n">us_zones</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Time</span><span class="o">.</span><span class="n">zone</span><span class="o">.</span><span class="n">name</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>in View template</li>
</ul>


<p>changing time zone by (if time zone is &lsquo;Arizona&rsquo;)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">datetime</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">created_at</span><span class="o">.</span><span class="n">in_time_zone</span><span class="p">(</span><span class="s2">&quot;Arizona&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Conclusion</h3>

<p>Using gem is a way for Rails how to DRY our codes. Rails flavored Ajax is also antoher way to do that. Exciting to know these.</p>

<p>Finally, the last week is coming to the end. The final project <code>Postit</code> seems become into reality app we daily use. And rails pieces are making together and show me how to build a basic function app.</p>

<p>After these two course, I think now I have confidence to read through other Rails introducion books I used to not understand.About Course 3, there is no reason I do NOT keep going since I decide to make a career change. Glad that I survived through the first two courses, and I think I&rsquo;m ready for the course 3 challenge.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reflection to Tealeaf Course2 Lesson3]]></title>
    <link href="http://www.tomohung.com/blog/2015/02/16/reflection-to-tealeaf-course2-lesson3/"/>
    <updated>2015-02-16T08:37:25+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/02/16/reflection-to-tealeaf-course2-lesson3</id>
    <content type="html"><![CDATA[<p>In Course2(Rapid Prototyping with Ruby on Rails), <a href="http://www.tomohung.com/blog/2015/02/02/reflection-to-tealeaf-course-2-lesson-1/">first week</a> I learned about <code>Models and database</code>, <a href="http://www.tomohung.com/blog/2015/02/10/reflection-to-tealeaf-course2-lesson2/">second week</a> I learned about <code>Controllers and Views</code>. This week I learned to add some features into my app, and make it vivid!!</p>

<!--more-->


<h3>Authentication</h3>

<p>Rails offer built-in function to help us add authentication. Here are steps:</p>

<ul>
<li>install gem &lsquo;Bcrypt&rsquo;.</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem 'bcrypt', '~&gt; 3.1.7' # use gem `bcrypt-ruby`, `=3.0.1` if any problem</span></code></pre></td></tr></table></div></figure>


<ul>
<li>run <code>bundle install</code> to install gem.</li>
<li><p>add migration for attribute:<code>password_digest</code>, like:</p>

<pre><code>class AddPasswordDigestToUsers &lt; ActiveRecord::Migration
  def change
    add_column :users, :password_digest, :string
  end
end
</code></pre></li>
<li>add method to <code>Use Model</code></li>
</ul>


<figure class='code'><figcaption><span>User.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_secure_password</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>has_secure_password</code> built-in some validations, if we want to customize validation, add parameter:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">has_secure_password</span> <span class="ss">validations</span><span class="p">:</span> <span class="kp">false</span>
</span></code></pre></td></tr></table></div></figure>


<p>here are some test from Rails API:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;david&#39;</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="ss">password_confirmation</span><span class="p">:</span> <span class="s1">&#39;nomatch&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">user</span><span class="o">.</span><span class="n">save</span>                                                       <span class="c1"># =&gt; false, password required</span>
</span><span class='line'><span class="n">user</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;mUc3m00RsqyRe&#39;</span>
</span><span class='line'><span class="n">user</span><span class="o">.</span><span class="n">save</span>                                                       <span class="c1"># =&gt; false, confirmation doesn&#39;t match</span>
</span><span class='line'><span class="n">user</span><span class="o">.</span><span class="n">password_confirmation</span> <span class="o">=</span> <span class="s1">&#39;mUc3m00RsqyRe&#39;</span>
</span><span class='line'><span class="n">user</span><span class="o">.</span><span class="n">save</span>                                                       <span class="c1"># =&gt; true</span>
</span><span class='line'><span class="n">user</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="s1">&#39;notright&#39;</span><span class="p">)</span>                                   <span class="c1"># =&gt; false</span>
</span><span class='line'><span class="n">user</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="s1">&#39;mUc3m00RsqyRe&#39;</span><span class="p">)</span>                              <span class="c1"># =&gt; user</span>
</span><span class='line'><span class="no">User</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;david&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">try</span><span class="p">(</span><span class="ss">:authenticate</span><span class="p">,</span> <span class="s1">&#39;notright&#39;</span><span class="p">)</span>      <span class="c1"># =&gt; false</span>
</span><span class='line'><span class="no">User</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;david&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">try</span><span class="p">(</span><span class="ss">:authenticate</span><span class="p">,</span> <span class="s1">&#39;mUc3m00RsqyRe&#39;</span><span class="p">)</span> <span class="c1"># =&gt; user</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Login / Logout</h3>

<p>We can use <code>session</code> to store our login information. First add routes</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">get</span> <span class="s1">&#39;/register&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;users#new&#39;</span>
</span><span class='line'>  <span class="n">get</span> <span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;sessions#new&#39;</span>
</span><span class='line'>  <span class="n">post</span> <span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;sessions#create&#39;</span>
</span><span class='line'>  <span class="n">delete</span> <span class="s1">&#39;/logout&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;sessions#destroy&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And <code>SessionsController</code>:</p>

<figure class='code'><figcaption><span>SessionController.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">SessionsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">new</span>
</span><span class='line'>    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by</span> <span class="ss">username</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:username</span><span class="o">]</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">user</span> <span class="o">&amp;&amp;</span> <span class="n">user</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;Login Success.&#39;</span>
</span><span class='line'>      <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>
</span><span class='line'>      <span class="n">redirect_to</span> <span class="n">root_path</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="n">flash</span><span class="o">[</span><span class="ss">:error</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Username or Password may not correct. Try again.&quot;</span>
</span><span class='line'>      <span class="n">render</span> <span class="ss">:new</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">destroy</span>
</span><span class='line'>    <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="kp">nil</span>
</span><span class='line'>    <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;Log out&#39;</span>
</span><span class='line'>    <span class="n">redirect_to</span> <span class="n">root_path</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Polymorphic table</h3>

<p>Sometimes many tables have relationship with the same one table, like <code>User</code> has many gravatar images, and <code>Post</code> has many images. So <code>User</code> and <code>Post</code> are using the same table <code>Picture</code>. We can do <code>Polymorpic table</code> association like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Picture</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:imageable</span><span class="p">,</span> <span class="ss">polymorphic</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:pictures</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:imageable</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:pictures</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:imageable</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then Rails will automatically assign two virtual attribute for us:<code>imageable_type</code> and <code>imageable_id</code></p>

<p><code>type</code> is stored which object type use this Picture, and <code>id</code> is for that object&rsquo;s table id.</p>

<p>Then, we can save data like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@picture</span> <span class="o">=</span> <span class="no">Picture</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">imageable</span><span class="p">:</span> <span class="n">post</span><span class="p">,</span> <span class="ss">user_id</span><span class="p">:</span> <span class="n">current_user_id</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Deploy to Heroku</h3>

<p>Last step, deploy to heroku makes this app engage with people!!</p>

<p>The only thing I&rsquo;ll record here is <code>make sure to run **heroku run rake db:migrate**</code>. Otherwise heroku will not generate a database for us.</p>

<h3>Conclusion</h3>

<p>Seems that my app becomes more and more closer to real world app we used everyday. There&rsquo;re still a lot of things to combine them together for improvement, like <code>tab control</code>, <code>Ajax</code>, <code>friendly routes path name</code>, etc.</p>

<p>Security is one of the most imporatant thing when we using internet, it&rsquo;s absolutely not safe if we store our password by plain text. Use a <code>one way has/ password digest</code> to instead of plain text password. There is one more thing, <code>MD5</code> has been broken too.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tealeaf Course2 Lesson3 Quiz]]></title>
    <link href="http://www.tomohung.com/blog/2015/02/15/tealeaf-course2-lesson3-quiz/"/>
    <updated>2015-02-15T08:22:00+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/02/15/tealeaf-course2-lesson3-quiz</id>
    <content type="html"><![CDATA[<blockquote><h4>1. What&rsquo;s the difference between rendering and redirecting? What&rsquo;s the impact with regards to instance variables, view templates?</h4></blockquote>

<ul>
<li>rendering: render a template HTML code, like <code>partial</code>.</li>
<li>redirecting: make a new request to controller.</li>
</ul>


<!--more-->


<p>Regards to instance variables for showing view templates, instance variables only survive at the same request, so if we need some information like errors store in instance variables, we need to use <code>render</code> for this condition.</p>

<blockquote><h4>2. If I need to display a message on the view template, and I&rsquo;m redirecting, what&rsquo;s the easiest way to accomplish this?</h4></blockquote>

<p>Use <code>flash</code> to store error message. This is the easiest way to store <code>one message</code>.</p>

<blockquote><h4>3. If I need to display a message on the view template, and I&rsquo;m rendering, what&rsquo;s the easiest way to accomplish this?</h4></blockquote>

<p>Use <code>instance variable</code> to store errors, then <code>render</code>.</p>

<p>* or use <code>flash.now</code> and render it.</p>

<blockquote><h4>4. Explain how we should save passwords to the database.</h4></blockquote>

<p>Use <code>one way hash</code>. Since we can&rsquo;t promise that data in database never be stolen, the way to protect our password is using a <code>one way hash</code> to store the digest. If someone get this digest, it&rsquo;s hard for him to decyphor this digest to a plain text password.</p>

<blockquote><h4>5. What should we do if we have a method that is used in both controllers and views?</h4></blockquote>

<p>Put the methods into controllers, and make them become helpers. Like:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>helper_method :current_user</span></code></pre></td></tr></table></div></figure>


<p>Now, method <code>current_user</code> can be used in both controllers and views.</p>

<blockquote><h4>6. What is memoization? How is it a performance optimization?</h4></blockquote>

<p>Some repeatedly query action for database will reduce our app performance, using <code>memoization</code> to overcome this.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@comment ||= User.find(session[:user_id]) if session[:user_id]</span></code></pre></td></tr></table></div></figure>


<p>Syntax <code>||=</code> do a <code>OR</code> combined action, if <code>@comment</code> is <code>nil</code>, then <code>User.find</code> invokes; if <code>@comment</code> exist, just return @comment without invoke <code>User.find</code>. This prevent to invoke database query again.</p>

<blockquote><h4>7. If we want to prevent unauthenticated users from creating a new comment on a post, what should we do?</h4></blockquote>

<p>Add a helper method <code>required_login</code> in <code>before_action</code> for actions <code>create</code> and &lsquo;&rsquo;. Since this method is used in both <code>post</code> and <code>comment</code>, we can put this method into <code>ApplicationController.rb</code>.</p>

<blockquote><h4>8. Suppose we have the following table for tracking &ldquo;likes&rdquo; in our application. How can we make this table polymorphic? Note that the &ldquo;user_id&rdquo; foreign key is tracking who created the like.</h4></blockquote>

<table>
<thead>
<tr>
<th style="text-align:right;"> id </th>
<th></th>
<th style="text-align:right;"> user_id </th>
<th></th>
<th style="text-align:right;"> photo_id  </th>
<th></th>
<th style="text-align:right;"> video_id  </th>
<th></th>
<th style="text-align:right;"> post_id</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">1 </td>
<td></td>
<td style="text-align:right;">4 </td>
<td></td>
<td style="text-align:right;"> </td>
<td></td>
<td style="text-align:right;"> 12 </td>
<td></td>
<td style="text-align:right;"> </td>
</tr>
<tr>
<td style="text-align:right;">2 </td>
<td></td>
<td style="text-align:right;">7 </td>
<td></td>
<td style="text-align:right;">  </td>
<td></td>
<td style="text-align:right;">  </td>
<td></td>
<td style="text-align:right;">3 </td>
</tr>
<tr>
<td style="text-align:right;">3 </td>
<td></td>
<td style="text-align:right;">2 </td>
<td></td>
<td style="text-align:right;">6 </td>
<td></td>
<td style="text-align:right;">  </td>
<td></td>
<td style="text-align:right;"> </td>
</tr>
</tbody>
</table>


<p>According to this table, there should be 5 tables in database:</p>

<ul>
<li>User</li>
<li>Photo</li>
<li>Video</li>
<li>Post</li>
<li>Like</li>
</ul>


<p>And here are they might be in models:</p>

<figure class='code'><figcaption><span>User.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:likes</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="n">likeable</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Photo.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Photo</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:likes</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="n">likeable</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Video.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Video</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:likes</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="n">likeable</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Post.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Post</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:likes</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="n">likeable</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Like.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Like</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:user_id</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:likeable</span><span class="p">,</span> <span class="ss">polymorphic</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><h4>9. How do we set up polymorphic associations at the model layer? Give example for the polymorphic model (eg, Vote) as well as an example parent model (the model on the 1 side, eg, Post).</h4></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Vote</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:voteable</span><span class="p">,</span> <span class="ss">polymorphic</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:votes</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="n">voteable</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><h4>10. What is an ERD diagram, and why do we need it?</h4></blockquote>

<p>Entity Relationship Dirgram(ERD) stands for tables in database relationship between each others. It&rsquo;s a convinient way to communicate with others what the tables relationship, even for ourselves under developming.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reflection to Tealeaf Course2 Lesson2]]></title>
    <link href="http://www.tomohung.com/blog/2015/02/10/reflection-to-tealeaf-course2-lesson2/"/>
    <updated>2015-02-10T16:39:30+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/02/10/reflection-to-tealeaf-course2-lesson2</id>
    <content type="html"><![CDATA[<p><a href="http://www.tomohung.com/blog/2015/02/02/reflection-to-tealeaf-course-2-lesson-1/">Last week</a>, I know Models and Database side of Rails.</p>

<p>This week Tealeaf reveals the <code>Controller</code> and <code>View</code> part of MVC, I would like to summarize this lesson into two parts: <code>Don't Repeat Yourself</code> and <code>Conventions over Configuration</code>.</p>

<!--more-->


<h3>Don&rsquo;t Repeat Yourself</h3>

<ul>
<li><p>before_action</p>

<p>Like Sinatra, before_action works at Controller, help us to remove repeatedly codes, like</p>

<pre><code>  before_action: :set_post, only: [:show, :edit, :update]
</code></pre>

<pre><code>  def set_post
    @post = Post.find(param[:id])
  end
</code></pre>

<p>then, method <code>set_post</code> works at three actions : show, edit, update by once.</p></li>
<li><p>form partial</p>

<p>Rails offer <code>form partial</code> to help us eliminate repeatedly <code>HTML codes</code>, by Rails convention, if there is a file called <code>/app/views/posts/_post.erb</code>, I can just write code:</p>

<pre><code>  &lt;%= render @post %&gt;
</code></pre>

<p>if @post is a class Post&rsquo;s instance, then Rails will automatically match to the file <code>_post.erb</code>, then render this file.</p>

<p>There is another amazing way to show collection of instances. If I have a collection instance <code>@posts</code> by class Post, then I have write</p>

<pre><code>  &lt;%= render @posts %&gt;
</code></pre>

<p>Rails will also automatically match the file <code>_post.erb</code> to iterate to render <code>@posts</code>. What a clean way to write such codes!</p></li>
<li><p>Helpers for view: fix url and datetime</p>

<p>We also can put some logic in Views into <code>/helpers</code>, like <code>application_helper.rb</code>. Put a lot of logic in Views is a dirty way when reviewing, and Rails have helpers to make us a clean way to do this. <code>Form Helper</code> is another good implement to help us. I&rsquo;ll metion later.</p></li>
<li><p>validations</p>

<p>Rails offer a simple to validate data in Model, like this</p>

<pre><code class="ruby post.rb">validates :title, presence: true, length: {minimum: 5}
</code></pre></li>
</ul>


<h3>Conventions over Configuration</h3>

<ul>
<li><p>CRUD
For most popular actions on web, there are 4 actions: Create, Retrieve, Update, Delete.
Rails offer a RESTful setting to make implemention these actions much simple.</p>

<p>For example, in <code>routes.rb</code>:</p>

<pre><code>  resources :posts
</code></pre>

<p>help us to build 7 actions corespond with VERBs and URIs.</p>

<pre><code>get '/posts/', to: "posts#index", as: "posts"
get '/posts/:id', to: "posts#show", as: "post"
get '/posts/new', to: "posts#new", as: "new_post"
post '/posts/', to: "posts#create",
get '/posts/:id', to: "posts#edit", as: "edit_post"
patch '/posts/:id', to: "posts#update"
delete '/posts/:id', to: "posts#destroy"
</code></pre>

<p>I also can use key word <code>except:</code> or <code>only:</code> to assign which routes will be created:</p>

<pre><code>  resources :posts, except: [:destory]
  resources :comments, only: [:create]
</code></pre></li>
<li><p>nested routes
Rails also offer a way to create nested path like <code>/posts/:id/comments</code></p>

<pre><code>  resources :posts, except: [:destory] do
    resources :comments, only: [:create]
  end
</code></pre>

<p>And this will create route for <code>comments#create</code> by nested route</p>

<pre><code>  post '/posts/:post_id/comments', to: "comments#create", as: "post_comments"
</code></pre></li>
<li><p>model backed form</p>

<p>Using <code>Model backed form</code> can associated with instance, then Rails do a lot of task behind the form.</p>

<pre><code>&lt;%= form_for [@post, @comment] do |f| %&gt;  
  &lt;%= render 'shared/error_messages', instance: @comment %&gt;
  &lt;%= f.label :body, 'Leave a Comment:'%&gt;
  &lt;%= f.text_area :body , rows: 5, class: 'span4'%&gt;
  &lt;br&gt;
  &lt;%= f.submit class: 'btn btn-defualt'%&gt;
&lt;% end %&gt;
</code></pre>

<p><code>[@post, @comment]</code> is a Rails convention for creating matching routes for <code>posts/coments</code>. And this form help us to create HTML element depends on what current action is. There are different actions in <strong>edit</strong> and <strong>new</strong> actions. <code>label</code> will update information if it&rsquo;s at edit action, and form action will generate a hidden attribute to store info that current actions VERB. This are all Rails conventions.</p></li>
<li><p>category_ids for checkboxes</p>

<p>Rails offer a helper to create checkboxes, like this</p>

<pre><code>&lt;%= form_for @post do |f| %&gt;
  &lt;%= f.collection_check_boxes :category_ids, Category.all, :id, :name do |cb| %&gt;
    &lt;%= cb.label(class: 'checkbox inline') {cb.check_box(class: 'checkbox') + cb.text}%&gt;
  &lt;% end %&gt;
&lt;% end %&gt;
</code></pre>

<p>And there is a virtual attribute for <code>category_ids</code>, it&rsquo;s generated because we set posts and categories&rsquo;s associations in Post Models:</p>

<pre><code>class Post &lt; ActiveRecord::Base
  belongs_to :creator, foreign_key: :user_id, class_name: "User"
  has_many :comments
  has_many :post_categories
  has_many :categories, through: :post_categories
end
</code></pre>

<p>and <code>category_ids</code> store multiple values to match <code>collection_check_boxes</code>. Rails another magic show.</p></li>
<li><p>auto association by mass-assignment</p>

<p>We can write</p>

<pre><code>  @comment = @post.comments.new(param.require(:comment).permit!)
</code></pre>

<p>Rails will auto assign post_id to @comment.</p></li>
</ul>


<h3>Others</h3>

<ul>
<li><p>Strong parameters</p>

<p>After Rails 4, Rails lock params by default, we need to get params by this way</p>

<pre><code>params.require(:post).permit(:title, :url, :description, category_ids:[])
</code></pre>

<p>If we have to get a collection values, remember to add <code>[]</code></p></li>
<li><p>render vs redirect_to</p>

<p><code>render</code> is for render HTML, and <code>redirect_to</code> is for make a new request. Although we see the page is changed, but it&rsquo;s totally different behind these two ways.</p></li>
</ul>


<h3>Conclusion</h3>

<p>  I can&rsquo;t imagine how can I figure out such mass Rails knowledge by myself in two weeks. Here is my learning processes: <code>watch video -&gt; 'I knew it!' -&gt; do assignment -&gt; 'What? How to do that?' -&gt; watch solution -&gt; 'Ah! I got it!' -&gt; complete assignment</code>. And these things happen again and again.</p>

<p>  Watching option videos and reviewing disscusions also help me to dig out what I missed.</p>

<p>  I should do the official guide again, and I think this time will be a totally different feeling compared with two weeks ago.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tealeaf Course2 Lesson2 Quiz]]></title>
    <link href="http://www.tomohung.com/blog/2015/02/08/tealeaf-course2-lesson2-quiz/"/>
    <updated>2015-02-08T14:13:48+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/02/08/tealeaf-course2-lesson2-quiz</id>
    <content type="html"><![CDATA[<blockquote><h4>1. Name all the 7 (or 8) routes exposed by the resources keyword in the routes.rb file. Also name the 4 named routes, and how the request is routed to the controller/action.</h4></blockquote>

<p>  For example by table <code>posts</code>:</p>

<table>
<thead>
<tr>
<th>Prefix   </th>
<th>Verb   </th>
<th>URI   </th>
<th>Controller#Action   </th>
</tr>
</thead>
<tbody>
<tr>
<td>posts   </td>
<td>GET   </td>
<td>/posts   </td>
<td>posts#index   </td>
</tr>
<tr>
<td>new_post   </td>
<td>GET   </td>
<td>/posts/new   </td>
<td>post#new   </td>
</tr>
<tr>
<td>   </td>
<td>POST   </td>
<td>/posts   </td>
<td>post#create   </td>
</tr>
<tr>
<td>post   </td>
<td>GET   </td>
<td>/posts/:id   </td>
<td>post#show   </td>
</tr>
<tr>
<td>edit_post   </td>
<td>GET   </td>
<td>/posts/:id   </td>
<td>post#edit   </td>
</tr>
<tr>
<td>   </td>
<td>PUT/PATCH   </td>
<td>/posts/:id   </td>
<td>post#update   </td>
</tr>
<tr>
<td>   </td>
<td>DELETE   </td>
<td>/posts/:id   </td>
<td>post#destroy   </td>
</tr>
</tbody>
</table>


<!--more-->


<blockquote><h4>2. What is REST and how does it relate to the resources routes?</h4></blockquote>

<p>  REST is abbreviation for <code>Representational State Transfer</code>. It use a VERB and a URI to operate some action for web application. And it&rsquo;s corespond to 4 HTTP VERB: GET, POST, PUT, DELETE with 7 actions: index, show, new, create, edit, update, destroy.</p>

<blockquote><h4>3. What&rsquo;s the major difference between model backed and non-model backed form helpers?</h4></blockquote>

<p>  <code>Model backed form</code> from helpers like <code>form_for</code>, it can automatically association with objects in table, and it can dynamic generate coresponding element for different actions(ex. edit and new).</p>

<p>  <code>Non-model backed form</code> from helpers like <code>form_tag</code>, it operate elements without relationship of tables in database.</p>

<blockquote><h4>4. How does form_for know how to build the <form> element?</h4></blockquote>

<p>  form_for based on given object, like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  &lt;%= form_for @posts do |f| %&gt;
</span><span class='line'>    &lt;%= f.label :title %&gt;
</span><span class='line'>    &lt;%= f.text_field :title %&gt;
</span><span class='line'>    &lt;%= f.submit %&gt;
</span><span class='line'>  &lt;% end %&gt;</span></code></pre></td></tr></table></div></figure>


<p>  There&rsquo;s a hidden attribute in form to record that what&rsquo;s action for this request. Rails regconize this hidden attribute to build <form> element. It will automatically create submit button by what action is called.</p>

<blockquote><h4>5. What&rsquo;s the general pattern we use in the actions that handle submission of model-backed forms (ie, the create and update actions)?</h4></blockquote>

<p>For creating a post: <code>POST /posts</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def create
</span><span class='line'>  @post = Post.new(params.require(:post).permit!)
</span><span class='line'>  if @post.save
</span><span class='line'>    redirect_to posts_path
</span><span class='line'>  else
</span><span class='line'>    render :new
</span><span class='line'>  end
</span><span class='line'>end  </span></code></pre></td></tr></table></div></figure>


<p>  For updating a post: <code>PUT /posts/:id</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def update
</span><span class='line'>  @post = Post.new(params.require(:post).permit!)
</span><span class='line'>  if @post.save
</span><span class='line'>    redirect_to post_path(@post)
</span><span class='line'>  else
</span><span class='line'>    render :edit
</span><span class='line'>  end
</span><span class='line'>end  </span></code></pre></td></tr></table></div></figure>


<blockquote><h4>6. How exactly do Rails validations get triggered? Where are the errors saved? How do we show the validation messages on the user interface?</h4></blockquote>

<p>  Rails validations get triggered in Model(ActiveRecord::Base), and errors are saved in Model.
  We can use Model&rsquo;s method to show error messages like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  instance.errors.full_messages</span></code></pre></td></tr></table></div></figure>


<p>  which instance is Model&rsquo;s instance.</p>

<blockquote><h4>7. What are Rails helpers?</h4></blockquote>

<p>  Rails helpers is a way to implement DRY principle in <code>View</code>, it abstract redundant <strong>logic codes</strong> in Views into helpers.
This make code in View more cleaner without too much logic in it.</p>

<blockquote><h4>8. What are Rails partials?</h4></blockquote>

<p>  Rails partials is a way to implement DRY principle in <code>View</code>, it abstract redundant <strong>HTML codes</strong> in Views into partial forms.</p>

<blockquote><h4>9. When do we use partials vs helpers?</h4></blockquote>

<p>  Partials is to eliminate repeatedly HTML codes in Views, and helpers is to eliminate repeatedly logic codes in Views.</p>

<blockquote><h4>10. When do we use non-model backed forms?</h4></blockquote>

<p>  Some input or showing requirements do not need to be associated with tables in database.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Newbie for Rails Migration]]></title>
    <link href="http://www.tomohung.com/blog/2015/02/02/newbie-for-rails-migration/"/>
    <updated>2015-02-02T21:46:35+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/02/02/newbie-for-rails-migration</id>
    <content type="html"><![CDATA[<p>As a newbie for Rails, It&rsquo;s normal to do something stupid.</p>

<h2>Modified migration files after <code>rake db:migrate</code></h2>

<p>It&rsquo;s useless!! Be carful that every migration filename including a timestamp, after running <code>rake db:migrate</code> will re-generate schema.rb. Data in schema.rb will show that the lastest timestamp, if there is no any new migration files newer than this timestamp, <code>rake db:migrate</code> will do nothing. Yes! it&rsquo;s nothing!!</p>

<figure class='code'><figcaption><span>normally you should see</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>==  CreateArticles: migrating ==================================================
</span><span class='line'>-- create_table(:articles)
</span><span class='line'>   -&gt; 0.0019s
</span><span class='line'>==  CreateArticles: migrated (0.0020s) =========================================
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>schema.rb has been updated, rake db:migrate do nothing</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ rake db:migrate
</span><span class='line'>$ rake db:migrate
</span></code></pre></td></tr></table></div></figure>


<!--more-->


<p>That&rsquo;s why I got stuck on it for a long time, because I make such a stupid mistake.</p>

<p>So, how about using <code>rake db:drop</code> or <code>rake db:rollback</code>. This is also a not smart choice, because you should consider that there may be some other co-workers are working on the same project. If they also run their migration on their computer, then you modified yourself migration files, or do some database operation like <code>rake db:rollback</code>. These actions will lead to some data error for database.</p>

<h2>Create another new migration file for modified database</h2>

<p>Using <code>rake generate migration do_some_change</code> for chaning database layer. Using another file to show the modified history is much clear. Avoid ambiguous and mess up all update contect in migration files is super important.</p>

<figure class='code'><figcaption><span>Add column for posts table</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>class AddColumnToPosts &lt; ActiveRecord::Migration
</span><span class='line'>  def change
</span><span class='line'>    add_column :posts, :user_id, :interger
</span><span class='line'>  end
</span><span class='line'>end
</span></code></pre></td></tr></table></div></figure>


<h2>Only use <code>rails generate migration</code></h2>

<p>Don&rsquo;t use <code>rails generate</code> for models or controllers etc. It contains a lot of rails magic. Although most of guide tour (including official guide) use this way. But it&rsquo;s easy to misunderstanding what is wrong for operating database layer and ActiveRecord layer. Take care of this!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reflection to Tealeaf Course 2 Lesson 1]]></title>
    <link href="http://www.tomohung.com/blog/2015/02/02/reflection-to-tealeaf-course-2-lesson-1/"/>
    <updated>2015-02-02T16:05:05+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/02/02/reflection-to-tealeaf-course-2-lesson-1</id>
    <content type="html"><![CDATA[<p>Finally, Rails is coming.</p>

<p>Before join Tealeaf, I&rsquo;ve tried few times to follow some rails guide books. I just can type some magic codes to build simplest web app but didn&rsquo;t know why at all, because I even didn&rsquo;t know what ruby is.</p>

<p>This time, passing through course 1, I knew what the ruby is, then following <a href="http://guides.rubyonrails.org/getting_started.html">official tour guide</a>, it&rsquo;s much clear than other books I&rsquo;ve seen. But I still got stuck on creating many-to-many relationship, because I made a stupid mistake here: <em>I modified migration file after running <code>rake db:migrate</code></em>.</p>

<p>Then I dived into solution videos, and Chirs said that:</p>

<blockquote><p>Don&rsquo;t use <code>rails generate</code> except <code>migration</code></p></blockquote>

<p>I do love this way, because:</p>

<ol>
<li><p>I never saw other&rsquo;s show this way to build migration, they always use <code>rails generate model</code> to create model and migration. And the problem is, I thought this is the only way to create models and migrations!! And I just thought this is Rails magic, I don&rsquo;t need to think too much.</p></li>
<li><p>When I got stuck because I didn&rsquo;t know I can&rsquo;t modified migration files after running <code>rake db:migrate</code>. Make sure migration setting is all done before running <code>rake db:migrate</code> is very important. And this is just for ActiveRecord layer, database is another layer. It&rsquo;s much easier to understand how could be a disaster to modified/delete migration files working with database layer.</p></li>
</ol>


<p>I make <a href="http://www.tomohung.com/blog/2015/02/02/newbie-for-rails-migration/">a post to record my big step for Rails</a>.</p>

<p>I also try to detect tealeaf discus panel, becuase I think it&rsquo;s better to <code>show who kudos this post</code>. Sometimes I just want to give a kudos for people reply my post without saying something more, but it&rsquo;s wierd for others to read this post, because they can&rsquo;t see kudos I already gave the post. Anyway, here is my ERD for discuss panel.</p>

<p><img src="http://i.minus.com/ibfrZjiBfElndg.jpg"></p>

<p>I&rsquo;m super satisfied that this week I found my mistake when using migrations, and I think there must be other mistake for controller&rsquo;s and view&rsquo;s. Moving to next lesson!!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tealeaf Course2 Lesson1 Quiz]]></title>
    <link href="http://www.tomohung.com/blog/2015/01/30/tealeaf-course2-lesson1-quiz/"/>
    <updated>2015-01-30T16:13:42+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/01/30/tealeaf-course2-lesson1-quiz</id>
    <content type="html"><![CDATA[<p>Answer these quizzes, then updated after watching solution.</p>

<h2>1. Why do they call it a relational database?</h2>

<p>  Relational database can store the relationship between data and data. For example, a table store customer&rsquo;s info, and a table store consuming record, these two table can be associated with another table, to establish the customer&rsquo;s consuming history. There are relationships between data and data in relational database. ex. sqlite, MySQL, PostgreSQL ect.</p>

<blockquote><p>the tables within the database are associated with each other. This association can be created with primary/foreign keys and various syntax.</p></blockquote>

<h2>2. What is SQL?</h2>

<p>  SQL(Structured Query Language), it&rsquo;s domain specific language to manipulate database.</p>

<!--more-->


<h2>3. There are two predominant views into a relational database. What are they, and how are they different?</h2>

<p>  There are two associations concepts in relational database:</p>

<ul>
<li><p>1:M
<strong>One to Many</strong> makes target object can associate with many other objects, like one customer can have many consuming records, we can track the customer&rsquo;s consuming history with this association or we can track the record is generated by which customer.</p></li>
<li><p>M:M
<strong>Many to Many</strong> makes target objects can associate with many other objects, like posts can be assign to many categories, and category can assign to many poasts. We also can track target post or target category is assigned to which one.</p></li>
</ul>


<blockquote><p>The two predominant views are the data and schema views.
Data view displays like a spreadsheet, with the table columns at the top and rows of data per each object instance.
A schema view shows us the column names and the value type of each column.</p></blockquote>

<h2>4. In a table, what do we call the column that serves as the main identifier for a row of data? We&rsquo;re looking for the general database term, not the column name.</h2>

<p>  Attributes. Column indicate that what the row values mean.</p>

<blockquote><p>We call this the &ldquo;primary key&rdquo;.</p></blockquote>

<h2>5. What is a foreign key, and how is it used?</h2>

<p>  Every row data in a table is included a <strong>primary key</strong>. If we want to associated with other table, we need this primary key to store which row data we wanna to be connected with this one. The store primary key value&rsquo;s column is called <strong>foreign key</strong>.</p>

<blockquote><p>A foreign key is the identifier that connects an association with the models involved. The foreign key is always on the &ldquo;many&rdquo; side and is always in an integer type.</p></blockquote>

<h2>6. At a high level, describe the ActiveRecord pattern. This has nothing to do with Rails, but the actual pattern that ActiveRecord uses to perform its ORM duties.</h2>

<p>  ActiveRecord is mapping the data operation in tables. It substitutes SQL operation and using migration files to define &amp; operate table column.</p>

<blockquote><p>ActiveRecord is a way to access the database. A database table is related to a class. An object of that class is created as a row in the table. This object can have different attribute values shown as the columns in the table. We can create, retrieve, update, and delete the object instances by altering the database table.</p></blockquote>

<h2>7. If there&rsquo;s an ActiveRecord model called &ldquo;CrazyMonkey&rdquo;, what should the table name be?</h2>

<p>  If I&rsquo;m confused with this, I can use <code>rails console</code> mode, to run</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>"CrazyMonkey".tableize</span></code></pre></td></tr></table></div></figure>


<p>  and the answer should be <code>crazy_monkeys</code>.</p>

<h2>8. If I&rsquo;m building a 1:M association between Project and Issue, what will the model associations and foreign key be?</h2>

<p>  in model files</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Project ActiveRecord::Base
</span><span class='line'>  has_many :issues
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>class Issue ActiveRecord::Base
</span><span class='line'>  belongs_to :project
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>  in migration files</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class CreateIssue ActiveRecord:Migration
</span><span class='line'>  def change
</span><span class='line'>    create_table :issues do |t|
</span><span class='line'>      t.integer :project_id
</span><span class='line'>    end
</span><span class='line'>  end</span></code></pre></td></tr></table></div></figure>


<h2>9. Given this code</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Zoo &lt; ActiveRecord::Base
</span><span class='line'>  has_many :animals
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<ul>
<li>What do you expect the other model to be and what does database schema look like?</li>
</ul>


<p>  There should be antoher class named &ldquo;Animal&rdquo;, and it belongs to Zoo. Animal should at least have name, and a foriegn key to set to zoo id.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Animal &lt; ActiveRecord::Base
</span><span class='line'>  belongs_to :zoo
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class CreateAnimal ActiveRecord:Migration
</span><span class='line'>  def change
</span><span class='line'>    create_table :animals do |t|
</span><span class='line'>      t.integer :zoo_id
</span><span class='line'>    end
</span><span class='line'>  end</span></code></pre></td></tr></table></div></figure>


<ul>
<li>What are the methods that are now available to a zoo to call related to animals?</li>
</ul>


<pre><code class="``">  zoo.animals
</code></pre>

<ul>
<li>How do I create an animal called &ldquo;jumpster&rdquo; in a zoo called &ldquo;San Diego Zoo&rdquo;?</li>
</ul>


<p>  If in <code>rails console</code> mode:</p>

<pre><code class="``">  $ zoo = Zoo.create(name: "San Diego Zoo")
  $ animal = Animal.create(name: "jumpster")
  $ zoo.animals &lt;&lt; animal  
</code></pre>

<h2>10. What is mass assignment? What&rsquo;s the non-mass assignment way of setting values?</h2>

<p>With mass assignment, we can do</p>

<p><code>assumption fields: [title, body]</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@post = Post.new(params[:post])</span></code></pre></td></tr></table></div></figure>


<p>without mass assignment, we need to do this</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@post = Post.new
</span><span class='line'>post.title = "post title"
</span><span class='line'>post.body = "post body"</span></code></pre></td></tr></table></div></figure>


<h2>11. What does this code do? <code>Animal.first</code></h2>

<p>Query the first data in table <code>Animal</code>.</p>

<blockquote><p>This will return the first row of data for the first Animal instance object in the animals table.</p></blockquote>

<h2>12. If I have a table called &ldquo;animals&rdquo; with columns called &ldquo;name&rdquo;, and a model called <code>Animal</code>, how do I instantiate an animal object with name set to &ldquo;Joe&rdquo;. Which methods makes sure it saves to the database?</h2>

<p>This will make sure it saves to database</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Animal.create(name: "Joe")</span></code></pre></td></tr></table></div></figure>


<p>And this will work too</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>animal = Animal.new(name: "Joe")
</span><span class='line'>animal.save</span></code></pre></td></tr></table></div></figure>


<h2>13. How does a M:M association work at the database level?</h2>

<p>  There is a join table between two relational tables, and it needs these two tables row data primary key to be its foreign key. For example, there is a join table called post_categories, and it stores two foriegn key named: post_id and category_id.</p>

<blockquote><p>On the database level of a M:M association, we use a join table to support it. Both of the primary models will each have a 1:M association with the join table.
By using the has_many :through technique, we are able to create an indirect M:M association with the two primary models.</p></blockquote>

<h2>14. What are the two ways to support a M:M association at the ActiveRecord model level? Pros and cons of each approach?</h2>

<ul>
<li><p>has_and_belongs_to_many
Chris metioned that this method is deprecated. If you don&rsquo;t need to operate the join table, this method is easy to set up association between two tables. And it&rsquo;s doing a more implicit way.</p></li>
<li><p>has_many through:
You have to define has_many relation with join table, also define has_many through: realtion to both target table and join table. This explicit the way to connect target table and join table. It&rsquo;s much easier to understand all realtionship between tables.</p></li>
</ul>


<blockquote><p>has_many :through requires an explicit join model and a join table, but it is more flexible and we can add additional attributes to the join table.
has_and_belongs_to_many doesn&rsquo;t require a join model or a join table, but it is less flexible and we cannot add additional attributes to the join table.</p></blockquote>

<h2>15. Suppose we have a User model and a Group model, and we have a M:M association all set up. How do we associate the two?</h2>

<figure class='code'><figcaption><span>User.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:user_groups</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:groups</span><span class="p">,</span> <span class="ss">through</span><span class="p">:</span> <span class="n">user_groups</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Group.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Group</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:user_groups</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">through</span><span class="p">:</span> <span class="ss">:user_groups</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>UserGroup.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">UserGroup</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:user</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:group</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>create_user_groups.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">CreateUserGroups</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">change</span>
</span><span class='line'>    <span class="n">create_table</span> <span class="ss">:post_categories</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">integer</span> <span class="ss">:user_id</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">integer</span> <span class="ss">:group_id</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reflection to Tealeaf Lesson 4]]></title>
    <link href="http://www.tomohung.com/blog/2015/01/22/reflection-to-tealeaf-lesson-4/"/>
    <updated>2015-01-22T11:59:53+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/01/22/reflection-to-tealeaf-lesson-4</id>
    <content type="html"><![CDATA[<p><img class="right" src="http://i.minus.com/iS2bpDcNcj44W.jpg" width="320"></p>

<p>To be honest, I still feel uncomfortable with this week. From week 3, I learned html &amp; css, to week 4, I learned jQuery &amp; Ajax. It&rsquo;s definitely not enough only rely on Codecademy&rsquo;s course, so I decide to do one more app, tic-tac-toe on wep. I think this should make me more comfortable with these lessons.</p>

<p>But I&rsquo;m wrong, ha!! I still get stuck when doing UI and interactive design. Since I already knew that the most important thing at this moment is becoming a robust rails development, I decide to keep my pace and going to next course.</p>

<p>Recap to this course:</p>

<ul>
<li>week 1, basic Ruby program.</li>
<li>week 2, OOP in Ruby.</li>
<li>week 3, <strong>HTTP is stateless</strong>, HTML &amp; CSS, Sinatra, and Bootstrap.</li>
<li>week 4, jQuery and Ajax.</li>
</ul>


<p>One more thing, I thought I could be a full stack web developer before this course, then I knew I&rsquo;m wrong. There are a lot of knowledge in front end.</p>

<p>And now I have to keep focus on back end.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[在Nitrous上寫Octopress]]></title>
    <link href="http://www.tomohung.com/blog/2015/01/16/clone-my-octopress-to-nitrous-dot-io/"/>
    <updated>2015-01-16T21:10:08+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/01/16/clone-my-octopress-to-nitrous-dot-io</id>
    <content type="html"><![CDATA[<h3>Octopress &amp; github</h3>

<p>這個部落格是用<a href="octopress.rog">Octopress</a>在<a href="github.com">github</a>上建立起來的。但是不像一般的部落格系統，可以只要用瀏覽器登入，就可以開始寫文章。不過既然知道<a href="nitrous.io">nitrous.io</a>可以雲端工作，所以就把腦筋動到它的上面去。</p>

<h3>Clone Octopress</h3>

<p>作法是參考<a href="http://blog.zerosharp.com/clone-your-octopress-to-blog-from-two-places/">這篇文章</a>。</p>

<p>但是其中的程式碼有點錯誤，因為github上存放網頁的位置己經改成github.io了。</p>

<!--more-->


<p>登入nitrous.io，開啟終端機畫面：
註：不會用可以參考<a href="http://www.tomohung.com/blog/2015/01/11/nitroukai-fa-huan-jing/">這個連結</a></p>

<p>輸入</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone -b source git@github.com:username/username.github.io.git octopress</span></code></pre></td></tr></table></div></figure>


<p>然後clone master branch到_deploy資料夾</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd octopress
</span><span class='line'>$ git clone git@github.com:username/username.github.io.git _deploy </span></code></pre></td></tr></table></div></figure>


<p>說明一下，branch <strong>source</strong> 就是存放原始資料，branch <strong>master</strong> 放的是rake後產生的資料，再上傳至github讓它來處理。</p>

<p>接著在nitrous安裝需要的gem</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ gem install bundler
</span><span class='line'>$ bundle install
</span><span class='line'>$ rake setup_github_pages</span></code></pre></td></tr></table></div></figure>


<p>輸入相關資料，這邊跟octopress上的安裝說明都是一樣的。
然後所有資料就會從github上完整的clone一份到nitrous上。</p>

<h3>Backup &amp; Sync</h3>

<p>每次寫完文章，最重要的是要記得備份。</p>

<p><code>rake deploy</code>就不用擔心，因為它就是把branch master上傳到github上。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rake generate
</span><span class='line'>$ rake deploy             # 更新 remote master branch</span></code></pre></td></tr></table></div></figure>


<p>但是branch source就要自己處理：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git add .
</span><span class='line'>$ git commit -m "message" 
</span><span class='line'>$ git push origin source  # 更新 remote source branch </span></code></pre></td></tr></table></div></figure>


<p>這樣子可以確保github上版本是最新的。</p>

<p>然後如果要在本機做完到nitrous做，或者是nitrous做完回本機，記得pull branch source 和 master。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd octopress
</span><span class='line'>$ git pull origin source  # 更新 local source branch
</span><span class='line'>$ cd ./_deploy
</span><span class='line'>$ git pull origin master  # 更新 local master branch</span></code></pre></td></tr></table></div></figure>


<p>這樣子就算是在外面用別台電腦，也能夠透過nitrous來blog一下了，不錯吧！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Show HTTP Is Stateless by Sinatra]]></title>
    <link href="http://www.tomohung.com/blog/2015/01/14/show-http-is-stateless-by-sinatra/"/>
    <updated>2015-01-14T21:25:15+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/01/14/show-http-is-stateless-by-sinatra</id>
    <content type="html"><![CDATA[<p>In tealeaf week 3, introduce to HTTP.</p>

<p>The most important thing is that, HTTP is stateless.</p>

<p>What&rsquo;s the influnce by this property? Showing this by Sinatra.</p>

<!--more-->


<p>first, follow <a href="http://www.sinatrarb.com/intro.html">Sinatra intro</a> to run basic function:
then try this code:</p>

<figure class='code'><figcaption><span>main.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;sinatra&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">before</span> <span class="k">do</span>
</span><span class='line'>  <span class="vi">@name</span> <span class="o">=</span> <span class="s1">&#39;Guest&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">erb</span> <span class="ss">:home</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">post</span> <span class="s1">&#39;/set_name&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="vi">@name</span> <span class="o">=</span> <span class="s1">&#39;tealeaf&#39;</span>
</span><span class='line'>  <span class="n">redirect</span> <span class="s1">&#39;/&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>and this will show a button, click the button will invoke a post request back to <code>set_name</code> in main.rb:</p>

<figure class='code'><figcaption><span>home.erb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;h4&gt;hi~ </span><span class="cp">&lt;%=</span> <span class="vi">@name</span> <span class="cp">%&gt;</span><span class="x"> &lt;/h4&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="x">&lt;form action=&quot;/set_name&quot; method=&quot;post&quot;&gt;</span>
</span><span class='line'><span class="x">  &lt;input class=&quot;btn&quot; type=&quot;submit&quot; name=&quot;name&quot;&gt;</span>
</span><span class='line'><span class="x">&lt;/form&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>OK, then what will <code>@name</code> show in home.erb after click button??</p>

<p>It shows <code>Guest</code>, not <code>tealeaf</code>. Why?</p>

<p><img src="http://i.minus.com/i9oeLWDYI4DBb.png"></p>

<p>The key point is: when 2 redirect to 3, it&rsquo;s a new request, instance variable like @name will be deleted after redirect, then create a new one.</p>

<p>That&rsquo;s why @name still shows <code>Guest</code>.</p>

<p>How about this way:</p>

<figure class='code'><figcaption><span>main.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;sinatra&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">before</span> <span class="k">do</span>
</span><span class='line'>  <span class="vi">@name</span> <span class="o">=</span> <span class="s1">&#39;Guest&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">erb</span> <span class="ss">:home</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">post</span> <span class="s1">&#39;/set_name&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="vi">@name</span> <span class="o">=</span> <span class="s1">&#39;tealeaf&#39;</span>
</span><span class='line'>  <span class="n">erb</span> <span class="ss">:home</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now using erb to embeded <code>home.erb</code> into the same request(&lsquo;/set_name&rsquo;). Then you&rsquo;ll see <code>@name</code> shows <code>tealeaf</code>!!</p>

<p>This experience shows me how HTTP is stateless.</p>

<p>And how web developers make it like stateness is a long way to go.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reflection to Tealeaf Week 3]]></title>
    <link href="http://www.tomohung.com/blog/2015/01/13/reflection-to-tealeaf-week-3/"/>
    <updated>2015-01-13T22:23:15+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/01/13/reflection-to-tealeaf-week-3</id>
    <content type="html"><![CDATA[<p><img class="right" src="http://i.minus.com/ilSTmPNHVpVTm.png" width="320"></p>

<p>It&rsquo;s realy a tough week for me, because I&rsquo;m totally new to web development.
There are lots of material need to be done:</p>

<ul>
<li>One new concept book: HTTP <a href="https://www.gotealeaf.com/books/http">https://www.gotealeaf.com/books/http</a></li>
<li>Two new languages: HTML &amp; CSS <a href="http://www.codecademy.com/tracks/htmlcss">http://www.codecademy.com/tracks/htmlcss</a></li>
<li>Two new frameworks: <a href="http://www.sinatrarb.com/intro.html">Sinatra</a> &amp; <a href="http://getbootstrap.com/">bootstrap</a></li>
</ul>


<p>I think the most important thing in this week is &ldquo;HTTP is stateless&rdquo;.</p>

<p>And using Sinatra show me this property explicit.</p>

<p>Every request in main.rb is independant with each other, using instance variables to store data only survive its scope.</p>

<p>I also write a brief post to memo this property<a href="http://www.tomohung.com/blog/2015/01/14/show-http-is-stateless-by-sinatra/">(HTTP is Stateless)</a>.
Using chache is another way to feel free in thinking programming in the old way.</p>

<p>Though I still use class to complete this assignment, I feel comfortable with this, because I don&rsquo;t need to make a wheel again.</p>

<p>The first struggle in this week is when I saw something like <code>&lt;form action..../&gt;</code>, I have no idea what&rsquo;s this?! because HTML &amp; CSS course in codecademy never metion this. After google that, I found there are plenty of other syntax I didn&rsquo;t know, <a href="http://www.w3schools.com/html/html5_intro.asp">w3shool</a> help me to know more about HTML.</p>

<p>Another struggle is Sinatra, when I first time read the intro, I totally had no idea what those nouns mean. <code>get '/' {}</code> seems not a nature ruby way; what <code>get</code> <code>post</code> are ??</p>

<p>Following with video and implement functions and pages, then I read Sinatra intro again, this time I feel much clear what its said.</p>

<p>Another horrible thing is on viewing video introduce to modern web development. There are so many tools, concepts, languages need to know. Wow&hellip;</p>

<p>To be a web development, I know I have to keep going.
Moving to Lesson 4.</p>

<p>Finally, here is my blog talking about Reflections for tealeaf lessons.
<a href="http://www.tomohung.com/blog/categories/tealeaf/">http://www.tomohung.com/blog/categories/tealeaf/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[譯]Maker's Schedule, Manager's Schedule]]></title>
    <link href="http://www.tomohung.com/blog/2015/01/12/yi-makers-schedule-managers-schedule/"/>
    <updated>2015-01-12T06:30:34+08:00</updated>
    <id>http://www.tomohung.com/blog/2015/01/12/yi-makers-schedule-managers-schedule</id>
    <content type="html"><![CDATA[<p>我曾經試過，寫程式最有效率的反而是在假日，可以從早上六點就一直做到晚上十二點（當然中間有被吃飯時間中斷），比起平常日在公司，產出高出好幾倍。所以看到這篇文章心有戚戚焉。</p>

<hr />

<p>原文出處：<a href="http://www.paulgraham.com/makersschedule.html">連結</a> Paul Graham, Y-Combinator founder</p>

<!--
One reason programmers dislike meetings so much is that they're on a different type of schedule from other people. Meetings cost them more.
-->


<p>對程式員來說不喜歡開會的原因之一，是因為他們和其它人平同的行程安排類型。</p>

<p>開會的代價更大。</p>

<!--
There are two types of schedule, which I'll call the manager's schedule and the maker's schedule. The manager's schedule is for bosses. It's embodied in the traditional appointment book, with each day cut into one hour intervals. You can block off several hours for a single task if you need to, but by default you change what you're doing every hour.
-->


<p>有兩種行程安排類型，管理者行程和製造者行程。管理者行程是給老闆用的，它是傳統上指派任務，每天把時間切成數個小時片段，你可以指派任務給其中幾個小時，但原則上，每個小時要做的事情都不一樣。</p>

<!--more-->




<!--
When you use time that way, it's merely a practical problem to meet with someone. Find an open slot in your schedule, book them, and you're done.
-->


<p>當你用這種方式時，就是一個很務實處理與人會面的問題。找一個空白的時段，註記起來，然後就完成了。</p>

<!--
Most powerful people are on the manager's schedule. It's the schedule of command. But there's another way of using time that's common among people who make things, like programmers and writers. They generally prefer to use time in units of half a day at least. You can't write or program well in units of an hour. That's barely enough time to get started.
-->


<p>很多有能力的人都是管理者類型。這是一種命令的安排。但對於製造產品，像是程式員和作家，還有另一種方式。他們通常時間的單位，傾向至少半天的區塊。你不能寫作或是寫程式用一個小時當單位。那只夠時間做個開頭而己。</p>

<!--
When you're operating on the maker's schedule, meetings are a disaster. A single meeting can blow a whole afternoon, by breaking it into two pieces each too small to do anything hard in. Plus you have to remember to go to the meeting. That's no problem for someone on the manager's schedule. There's always something coming on the next hour; the only question is what. But when someone on the maker's schedule has a meeting, they have to think about it.
-->


<p>當你處於製造者模式時，會議是個災難。一個會議就可以毀掉整個下午，時間切的零碎以致於很難做任何事。再加上你必需記住要去開會，這對管理者模型的人不是問題，他們總是在準備下一個小時要做的事，問題只是要處理的是什麼。但如果是製造者模式的人有一個會議，他們就必需掛念著它。</p>

<!--
For someone on the maker's schedule, having a meeting is like throwing an exception. It doesn't merely cause you to switch from one task to another; it changes the mode in which you work.
-->


<p>對於在製造者模式的人，有一個會議就像程式上丟出一個例外，它不只讓你轉換到另一個工作，同時他也改變你工作的型態。</p>

<!--
I find one meeting can sometimes affect a whole day. A meeting commonly blows at least half a day, by breaking up a morning or afternoon. But in addition there's sometimes a cascading effect. If I know the afternoon is going to be broken up, I'm slightly less likely to start something ambitious in the morning. I know this may sound oversensitive, but if you're a maker, think of your own case. Don't your spirits rise at the thought of having an entire day free to work, with no appointments at all? Well, that means your spirits are correspondingly depressed when you don't. And ambitious projects are by definition close to the limits of your capacity. A small decrease in morale is enough to kill them off.
-->


<p>我發現有時候一個會議可以影響一整天。至少毀了半天，早上或下什。另外附加的是有時候還會有階層效應。如果我知道下午會被切開，在早上我就會有點不想做任何事。我知道這聽起來有點過於敏感，但如果你也是製造者模式的人，想想你自己，你內心沒有出現一個想要可以有一整天工作，沒有任何約會的想法嗎？好吧，那表示你的內心在你不想的時候做出調適。一個有野心的計劃一定是非常接近你能力的極限，一個小小精神能力䧏低就足夠毀掉它們。</p>

<!--
Each type of schedule works fine by itself. Problems arise when they meet. Since most powerful people operate on the manager's schedule, they're in a position to make everyone resonate at their frequency if they want to. But the smarter ones restrain themselves, if they know that some of the people working for them need long chunks of time to work in.
-->


<p>兩種工作型式都很好，問題出在它們相遇的時候。既然大多數強力的管理者都使用管理者模式，他們必需讓每個人都配合他們工作的頻率，但是有些聽明的人不來這套，因為他們知道有些人就是需要足夠的大區塊時間來工作。</p>

<!--
Our case is an unusual one. Nearly all investors, including all VCs I know, operate on the manager's schedule. But Y Combinator runs on the maker's schedule. Rtm and Trevor and I do because we always have, and Jessica does too, mostly, because she's gotten into sync with us.
-->


<p>我們是一個不尋常的例子，幾乎所有投資人，包括創投基金，都是使用管理者模式。但是Y combinator是使用製造者模式。Rtm和Trvor和我都是，因為我們喜歡如此，還有Jessica也是如此，因為她必需和我們同步配合。</p>

<!--
I wouldn't be surprised if there start to be more companies like us. I suspect founders may increasingly be able to resist, or at least postpone, turning into managers, just as a few decades ago they started to be able to resist switching from jeans to suits.
-->


<p>如果有愈來愈多的公司和我們一樣，我也不會感到驚訝。我猜創業的人應該也開始會拒絕，或者說延遲同步到管理者模式。就像十幾年前他們開始排斥從襯杉轉換到穿牛仔褲。</p>

<!--
How do we manage to advise so many startups on the maker's schedule? By using the classic device for simulating the manager's schedule within the maker's: office hours. Several times a week I set aside a chunk of time to meet founders we've funded. These chunks of time are at the end of my working day, and I wrote a signup program that ensures all the appointments within a given set of office hours are clustered at the end. Because they come at the end of my day these meetings are never an interruption. (Unless their working day ends at the same time as mine, the meeting presumably interrupts theirs, but since they made the appointment it must be worth it to them.) During busy periods, office hours sometimes get long enough that they compress the day, but they never interrupt it.
-->


<p>那我們如何給那些製造者模式的新創團隊建議？經典的老方法，office hours。一週數次，我安排一個大區塊時間來看創辦人見面。這些時間都在我完成一天的工作後，我寫了一個登錄的程式來確保所有的約會都在一天的最後聚集起來。因為這些約會都在一天的最後，所以從來沒打斷我。（除非他們的工作時間和我一樣，不然會議通常會打斷他們自己的，不過既然他們約了這個會，我想對他們這是值得的）。當忙碌的時候，office hours有時候就顯得會壓縮到那天，但他們不會打斷它。</p>

<!--
When we were working on our own startup, back in the 90s, I evolved another trick for partitioning the day. I used to program from dinner till about 3 am every day, because at night no one could interrupt me. Then I'd sleep till about 11 am, and come in and work until dinner on what I called "business stuff." I never thought of it in these terms, but in effect I had two workdays each day, one on the manager's schedule and one on the maker's.
-->


<p>當我們在90年代創業的時候，我用另一個技巧來把一天分隔開。我通常在晚餐後寫程式寫到半夜三點，因為在晚上沒有人可以打擾我。然後我睡到早上十一點，繼續工作到晚餐，這段時間我叫它做商業工作。我沒有想過這，但我把一天分成兩個工作天，一個是管理者模式，一個是製造者模式。</p>

<!--
When you're operating on the manager's schedule you can do something you'd never want to do on the maker's: you can have speculative meetings. You can meet someone just to get to know one another. If you have an empty slot in your schedule, why not? Maybe it will turn out you can help one another in some way.
-->


<p>當你在管理者模式時你會做些你在製造者模式時不會做的事：觀察式約會。你可以和一些人見面僅只是要互相認識。如果你有一個空檔，為何不？或許有一天它會轉換成讓你幫助另一個人。</p>

<!--
Business people in Silicon Valley (and the whole world, for that matter) have speculative meetings all the time. They're effectively free if you're on the manager's schedule. They're so common that there's distinctive language for proposing them: saying that you want to "grab coffee," for example.
-->


<p>在矽谷的生意人（也可以說全世界有同樣問題的）總是在觀察式的約會。如果在管理者模式這是很有效率的。這是很普通的，有一句特別的代名詞可以表達：來杯咖啡吧！</p>

<!--
Speculative meetings are terribly costly if you're on the maker's schedule, though. Which puts us in something of a bind. Everyone assumes that, like other investors, we run on the manager's schedule. So they introduce us to someone they think we ought to meet, or send us an email proposing we grab coffee. At this point we have two options, neither of them good: we can meet with them, and lose half a day's work; or we can try to avoid meeting them, and probably offend them.
-->


<p>如果你是在製造者模式時，觀察式約會就變得很糟，讓我們被某個東西綁住。所有像那些投資人都假設，我們是在管理者模式。所以當他們要介紹某些我們應該要會面的人，或者是發封郵件來提議來杯咖啡吧，當這個時候我們有兩個選擇，兩個都不大好：去會面，但是損失半天的工作時間；或是拒絕會面但是可能會冒犯到他們。</p>

<!--
Till recently we weren't clear in our own minds about the source of the problem. We just took it for granted that we had to either blow our schedules or offend people. But now that I've realized what's going on, perhaps there's a third option: to write something explaining the two types of schedule. Maybe eventually, if the conflict between the manager's schedule and the maker's schedule starts to be more widely understood, it will become less of a problem.
-->


<p>直到最近我們還不能搞清楚問題的核心，我們只能打斷工作或是冒犯別人。但現在我己經了解到為什麼了，也許有一個第三個選擇方案：寫下來解譯這兩種模式。也許最後，管理者模式和製造者模式的不同會愈來愈多人知道，那這個問題就會少發生了。</p>

<!--
Those of us on the maker's schedule are willing to compromise. We know we have to have some number of meetings. All we ask from those on the manager's schedule is that they understand the cost.
-->


<p>那些希望我們這種製造者模式的人要妥協的，也知道我們必需去參加些會議，我們希望的只是那些管理者模式的人，知道這些會議背後的代價。</p>
]]></content>
  </entry>
  
</feed>
